### **M√≥dulo de Pedidos - Bit√°cora II**

Sistema completo para gesti√≥n de pedidos diarios con historial, exportaci√≥n y sistema gamificado de recompensas.

---

### üì¶ **Componentes Principales**

#### **TablaPedidos.vue**
- **Pantalla principal** del m√≥dulo de pedidos
- **Tabla de √∫ltimos 3 pedidos** realizados
- **Integraci√≥n completa** con ContadorPedidosDiarios
- **Bot√≥n agregar** para abrir ModalNuevoPedido
- **Navegaci√≥n** a PedidosRealizados y HistorialPedidos
- **Responsive** con dise√±o adaptativo

#### **ModalNuevoPedido.vue**
- **Modal para agregar pedidos** manualmente
- **Input manual**: agrega un solo pedido y cierra autom√°ticamente
- **Bot√≥n de c√°mara**: abre CamaraPedidos.vue para escanear m√∫ltiples c√≥digos
- **Validaciones** con feedback visual
- **Integraci√≥n** con sistema de persistencia

#### **CamaraPedidos.vue**
- **Modal con c√°mara embebida** en un `<div>` + botones personalizados
- **@zxing/library** para escaneo en tiempo real
- **Escaneo de c√≥digos de barra y QR**
- **Miniatura de √∫ltima captura**
- **Manejo de permisos** de c√°mara
- **Lista de c√≥digos escaneados** con opci√≥n de eliminar
- **Botones**: finalizar (confirma todos), cancelar

#### **PedidosRealizados.vue**
- **Lista completa** de todos los pedidos guardados
- **Ordenados por fecha** (m√°s recientes primero)
- **Bot√≥n enviar Excel** con todos los pedidos
- **Acciones individuales**: editar y eliminar
- **Modal de edici√≥n** integrado
- **Confirmaci√≥n** antes de eliminar
- **Contador total** de pedidos

#### **HistorialPedidos.vue**
- **Agrupaci√≥n de pedidos por fechas**
- **Vista expandible** por fecha
- **Exportaci√≥n por rango** de fechas seleccionado
- **Bot√≥n enviar Excel** del rango
- **Contador de pedidos** por fecha
- **Dise√±o tipo acorde√≥n** para mejor visualizaci√≥n

#### **‚úÖ ContadorPedidosDiarios.vue - Sistema Gamificado**
- **Contador autom√°tico** de pedidos del d√≠a actual
- **Reinicio a medianoche** autom√°tico (verificaci√≥n cada minuto)
- **üéØ Sistema de recompensas**: Iconos din√°micos seg√∫n productividad
  - üëç **1-9 pedidos**: Buen comienzo (fin de semana) / Necesita m√°s esfuerzo (laborable)
  - üî• **10-19 pedidos**: Bien (fin de semana) / Buen ritmo (laborable)
  - ‚ö° **20-29 pedidos**: Excelente (fin de semana) / Muy productivo (laborable)
  - ‚≠ê **30-39 pedidos**: Incre√≠ble (fin de semana) / Excelente d√≠a (laborable)
  - üíé **50+ pedidos**: Corona del d√≠a
- **L√≥gica diferenciada**: Fin de semana vs d√≠as laborables
- **5 niveles de logros**: Progresi√≥n motivacional
- **Persistencia** entre sesiones con `@capacitor/preferences`
- **Integraci√≥n completa** con TablaPedidos.vue
- **Actualizaci√≥n autom√°tica** al agregar pedidos
- **Responsive design** para m√≥viles

---

### üìÅ **L√≥gica de Exportaci√≥n**

#### **ExportarPedidosExcel.js**
- **Generaci√≥n de Excel** con pedidos
- **Dos modos**:
  - **Rango de fechas**: `Pedi Usuario DD-MM-AAAA - DD-MM-AAAA.xlsx`
  - **Mes actual**: `Pedi Usuario - MM-AAAA.xlsx`
- **Nombre de hoja**: Nombre del usuario
- **Columnas**: Fecha, C√≥digo del pedido
- **Formato de fecha**: DD/MM/AAAA
- **Ordenamiento**: Por fecha descendente
- **Integraci√≥n** con nombre de usuario de configuraci√≥n

#### **GeneraExcel.js**
- **M√≥dulo reutilizable** para generar Excel
- **Funci√≥n principal**: `generarYGuardarExcelTemporal()`
- **Recibe**: datos, nombre del archivo, nombre de hoja
- **Genera**: archivo Excel en memoria con `xlsx`
- **Guarda**: en `Directory.Cache` con `@capacitor/filesystem`
- **Retorna**: URI del archivo temporal
- **Formato**: Base64 para compatibilidad con Capacitor

#### **CompartirExcel.js** (en Logica/Pedidos/)
- **Funci√≥n**: `compartirArchivo(rutaArchivo, nombreArchivo)`
- **Share API nativa** de Capacitor
- **T√≠tulo**: "Exportar pedidos"
- **Manejo de errores** con logs detallados
- **Compatible** con todas las apps de compartir del sistema

---

### üíæ **Almacenamiento y Persistencia**

#### **usoAlmacenamientoPedidos.js**
- **M√≥dulo especializado** para pedidos
- **Funciones principales**:
  - `guardarPedidos(pedidos)`: Guarda array de pedidos
  - `obtenerPedidos()`: Recupera todos los pedidos
  - `agregarPedido(codigo)`: Agrega un pedido con fecha actual
  - `eliminarPedido(id)`: Elimina un pedido espec√≠fico
  - `editarPedido(id, nuevoCodigo)`: Modifica un pedido
  - `limpiarPedidos()`: Elimina todos los pedidos
- **Estructura de pedido**:
  {
    id: timestamp,
    codigo: "ABC123",
    fecha: "AAAA-MM-DD"
  }
- **Persistencia** en `@capacitor/preferences`
- **Key**: `"pedidos"`

---

### üéØ **Sistema de Logros Gamificado**

#### **L√≥gica de Niveles**
- **Detecci√≥n autom√°tica** de fin de semana (s√°bado/domingo)
- **Umbrales diferentes** seg√∫n d√≠a de la semana
- **Reconocimiento cada 10 pedidos** con cambio de icono
- **Persistencia del contador** durante todo el d√≠a
- **Reset autom√°tico** a las 00:00

#### **Mensajes Motivacionales**
- **Fin de semana**: Mensajes m√°s relajados
- **D√≠as laborables**: Mensajes enfocados en productividad
- **Progresi√≥n clara**: El usuario ve su avance en tiempo real

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **TablaPedidos.vue**
configuracionBarra: {
  mostrarAtras: true,
  mostrarInicio: true,
  mostrarAgregar: true,
  mostrarEnviar: false,
  puedeEnviar: false,
  botonesPersonalizados: []
}

#### **PedidosRealizados.vue**
configuracionBarra: {
  mostrarAtras: true,
  mostrarInicio: true,
  mostrarAgregar: false,
  mostrarEnviar: pedidos.length > 0,
  puedeEnviar: pedidos.length > 0,
  botonesPersonalizados: []
}

#### **HistorialPedidos.vue**
configuracionBarra: {
  mostrarAtras: true,
  mostrarInicio: true,
  mostrarAgregar: false,
  mostrarEnviar: hayRangoSeleccionado,
  puedeEnviar: hayRangoSeleccionado,
  botonesPersonalizados: []
}

---

### ‚úÖ **Flujo de Trabajo T√≠pico**

1. **Usuario entra a TablaPedidos**
   - Ve los √∫ltimos 3 pedidos
   - Ve su contador del d√≠a con icono de logro
   
2. **Agregar pedidos**:
   - **Opci√≥n A**: Click en bot√≥n agregar ‚Üí Modal ‚Üí Input manual ‚Üí Confirmar
   - **Opci√≥n B**: Click en bot√≥n agregar ‚Üí Modal ‚Üí Bot√≥n c√°mara ‚Üí Escanear m√∫ltiples ‚Üí Finalizar
   
3. **Ver todos los pedidos**:
   - Navega a PedidosRealizados
   - Ve lista completa ordenada
   - Puede editar o eliminar
   
4. **Exportar pedidos**:
   - **Desde PedidosRealizados**: Exporta todos los pedidos
   - **Desde HistorialPedidos**: Selecciona rango de fechas ‚Üí Exporta rango
   
5. **Sistema de logros**:
   - El contador se actualiza autom√°ticamente
   - El icono cambia cada 10 pedidos
   - Reset autom√°tico al d√≠a siguiente

---

### üìä **Estructura de Datos**

#### **Pedido Individual**
{
  id: 1704067200000,           // timestamp √∫nico
  codigo: "ABC123",             // c√≥digo del art√≠culo
  fecha: "2024-01-01"          // formato AAAA-MM-DD
}

#### **Array de Pedidos (en localStorage)**
[
  { id: 1704067200000, codigo: "ABC123", fecha: "2024-01-01" },
  { id: 1704067201000, codigo: "XYZ789", fecha: "2024-01-01" },
  { id: 1704153600000, codigo: "DEF456", fecha: "2024-01-02" }
]

#### **Datos del Contador Diario**
{
  fecha: "2024-01-01",         // fecha actual
  cantidad: 15                 // pedidos del d√≠a
}

---

### üé® **Caracter√≠sticas de UI/UX**

- **Tabla responsive** con dise√±o de cards en m√≥vil
- **Animaciones suaves** en transiciones
- **Feedback visual** inmediato al agregar/eliminar
- **Iconos consistentes** con @tabler/icons-vue
- **Estados de carga** con spinners
- **Notificaciones** de √©xito/error con Quasar Notify
- **Confirmaciones** antes de acciones destructivas
- **Colores tem√°ticos** seg√∫n logro alcanzado

---

### üîß **Dependencias Espec√≠ficas**

- **xlsx**: Generaci√≥n de archivos Excel
- **@capacitor/filesystem**: Guardado de archivos
- **@capacitor/share**: Compartir archivos
- **@capacitor/preferences**: Persistencia de datos
- **@zxing/library**: Escaneo de c√≥digos
- **@tabler/icons-vue**: Iconograf√≠a

---

### üìù **Notas Importantes**

- Los pedidos se guardan **autom√°ticamente** al agregarlos
- El contador diario se **resetea solo** a medianoche
- Los archivos Excel se generan en **memoria** y se guardan temporalmente
- El **nombre de usuario** de configuraci√≥n se integra en nombres de archivo
- El sistema de logros **motiva** la productividad sin ser intrusivo
