### **M√≥dulo de Etiquetas - Bit√°cora II**

Sistema completo para generar etiquetas con c√≥digos de barras Code 39 en documentos PDF personalizados.

---

### üì¶ **Componentes Principales**

#### **PaginaEtiquetas.vue**
- **P√°gina principal** del m√≥dulo de etiquetas
- **Ruta**: `/etiquetas`
- **Header con t√≠tulo** y selector de tama√±o
- **Selector de tama√±o**: 
  - **10x15 cm** (por defecto)
  - **5x10 cm**
  - **2.5x6.7 cm**
- **FormularioEtiqueta** para agregar etiquetas
- **TablaEtiquetas** con lista de etiquetas
- **Integraci√≥n con BarraBotonesInferior** para navegaci√≥n
- **Modal de confirmaci√≥n** para eliminar etiquetas
- **Persistencia autom√°tica** de etiquetas
- **Responsive design** adaptativo

#### **FormularioEtiqueta.vue**
- **Formulario completo** para agregar etiquetas
- **Campos**:
  - **C√≥digo del art√≠culo**: Input con buscador inteligente integrado
  - **Descripci√≥n**: Autocompletado desde base de datos
  - **Ubicaci√≥n**: Con formateo autom√°tico y bot√≥n limpiar
  - **Cantidad de copias**: Input num√©rico (m√≠nimo 1)
- **Bot√≥n de c√°mara** para escanear c√≥digos
- **Integraci√≥n con CamaraEscaneo.vue** para m√∫ltiples escaneos
- **Autocompletado completo**: Al seleccionar art√≠culo del buscador, autocompleta descripci√≥n y ubicaci√≥n
- **Validaciones** con feedback visual y animaciones de error
- **‚úÖ Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **‚úÖ Bot√≥n IconTrash** para limpiar ubicaci√≥n cuando cambia de zona

#### **TablaEtiquetas.vue**
- **Lista completa** de etiquetas agregadas
- **Header con contadores**:
  - Etiquetas totales
  - Copias totales
  - C√≥digos repetidos (si hay)
  - Art√≠culos inexistentes (si hay)
- **Columnas**:
  - **Nombre y C√≥digo**: Muestra nombre de la base de datos + c√≥digo
  - **Ubicaci√≥n**: Ubicaci√≥n del art√≠culo
  - **Cantidad**: Control inline con botones +/-
  - **Acciones**: Editar y eliminar
- **‚úÖ Detecci√≥n de c√≥digos duplicados** (fondo naranja)
- **‚úÖ Detecci√≥n de art√≠culos inexistentes** (fondo rojo)
- **Controles de cantidad inline**: Incrementar/decrementar sin modal
- **‚úÖ Modal personalizado para confirmar limpieza**: Usa ModalEliminar en lugar de confirm() nativo
- **Bot√≥n limpiar todo** con confirmaci√≥n
- **Responsive** con dise√±o de cards en m√≥vil
- **Integraci√≥n con base de datos** para mostrar nombres

#### **ModalEditarEtiqueta.vue**
- **Modal para editar** etiquetas existentes
- **Campos editables**: c√≥digo, descripci√≥n, ubicaci√≥n, cantidad
- **Validaciones** completas con feedback visual
- **Botones**: guardar y cancelar
- **Integraci√≥n** con sistema de etiquetas

---

### üìÑ **Sistema de Generaci√≥n de Documentos**

#### **GeneradorEtiquetasPDF.js**
- **Motor principal** para generar documentos PDF
- **Biblioteca**: `jsPDF` para crear archivos PDF
- **Configuraci√≥n modular**: Usa archivos de configuraci√≥n externos
- **Dimensiones personalizadas**: Cada configuraci√≥n define tama√±o de p√°gina
- **Layout adaptativo**: Ajusta elementos seg√∫n configuraci√≥n
- **‚úÖ Detecci√≥n de entorno**: Navegador web vs app m√≥vil
- **‚úÖ Descarga directa en navegador**: Sin usar Capacitor Filesystem
- **‚úÖ Nombres personalizados**: Integra nombre de usuario desde configuraci√≥n

**Contenido por etiqueta** (una p√°gina por etiqueta):
1. **C√≥digo del art√≠culo**: 
   - Posici√≥n, fuente y tama√±o configurables
   - **Sistema adaptativo**: Tama√±o de fuente cambia seg√∫n longitud del c√≥digo
   - 4 niveles: corto, mediano, largo, muy largo
2. **C√≥digo de barras**: PNG generado por GeneradorCodigoBarra.js
3. **Descripci√≥n**: 
   - **Tama√±o autom√°tico**: Ajuste inteligente seg√∫n longitud del texto
   - **Multil√≠nea**: Divisi√≥n autom√°tica de texto largo
   - **Interlineado configurable**
   - **M√°ximo de l√≠neas configurable**
   - **7 niveles de tama√±o**: muy corta, corta, mediana, larga, muy larga, extra larga, gigante
4. **Ubicaci√≥n**: Posici√≥n configurable (por defecto esquina inferior izquierda)

**Sistema de tama√±o autom√°tico de descripci√≥n**:
- Eval√∫a longitud del texto
- Aplica tama√±os seg√∫n rangos configurados
- Sistema de 7 niveles (muy corta a gigante)
- Posicionamiento din√°mico seg√∫n cantidad de l√≠neas

**Caracter√≠sticas avanzadas**:
- **Salto de p√°gina** autom√°tico entre etiquetas
- **Respeta cantidad de copias**: Genera p√°ginas duplicadas
- **Guardado temporal** con `@capacitor/filesystem` en `Directory.Cache` (solo m√≥vil)
- **Descarga directa en navegador**: No requiere Capacitor
- **Conversi√≥n a base64** para compatibilidad con Capacitor (solo m√≥vil)
- **Retorna**: URI del archivo + nombre del archivo

**Funci√≥n principal**: `generarDocumentoEtiquetas(listaEtiquetas, configuracion)`

---

### üìê **Configuraciones de Etiquetas Disponibles**

El sistema es **totalmente modular** y soporta m√∫ltiples tama√±os de etiquetas. Cada configuraci√≥n define propiedades espec√≠ficas para cada tama√±o.

#### **ConfiguracionEtiqueta10x15.js**
- **Tama√±o**: 10x15 cm (100mm x 150mm)
- **Orientaci√≥n**: Horizontal (landscape)
- **M√°rgenes**: 4mm
- **C√≥digo de art√≠culo**:
  - Tama√±os adaptativos: 50pt, 40pt, 36pt, 25pt
  - Posici√≥n Y: 15mm
- **C√≥digo de barras**: 
  - Dimensiones: 90mm x 17mm
  - Posici√≥n Y: 16mm
  - Tama√±o interno: 'grande'
- **Descripci√≥n**:
  - Tama√±os: 60pt ‚Üí 24pt (7 niveles)
  - Ancho m√°ximo: 140mm
  - M√°ximo l√≠neas: 7
  - Interlineado: factor 0.35
- **Ubicaci√≥n**: 10pt, esquina inferior izquierda

#### **ConfiguracionEtiqueta5x10.js**
- **Tama√±o**: 5x10 cm (50mm x 100mm)
- **Orientaci√≥n**: Horizontal (landscape)
- **M√°rgenes**: 2.5mm
- **C√≥digo de art√≠culo**:
  - Tama√±os adaptativos: 25pt, 20pt, 18pt, 12pt
  - Posici√≥n Y: 7.5mm
- **C√≥digo de barras**: 
  - Dimensiones: 73mm x 11mm
  - Posici√≥n Y: 10.5mm
  - Tama√±o interno: 'mediano'
- **Descripci√≥n**:
  - Tama√±os: 30pt ‚Üí 12pt (7 niveles)
  - Ancho m√°ximo: 93mm
  - M√°ximo l√≠neas: 5
  - Interlineado: factor 0.35
- **Ubicaci√≥n**: 6.5pt, esquina inferior izquierda

#### **ConfiguracionEtiqueta2.5x6.7.js**
- **Tama√±o**: 2.5x6.7 cm (25mm x 67mm)
- **Orientaci√≥n**: Horizontal (landscape)
- **M√°rgenes**: 1.5mm
- **C√≥digo de art√≠culo**:
  - Tama√±os adaptativos: 12pt, 10pt, 9pt, 7pt
  - Posici√≥n Y: 4mm
- **C√≥digo de barras**: 
  - Dimensiones: 50mm x 6mm
  - Posici√≥n Y: 5.5mm
  - Tama√±o interno: 'chico'
- **Descripci√≥n**:
  - Tama√±os: 15pt ‚Üí 6pt (7 niveles)
  - Ancho m√°ximo: 62mm
  - M√°ximo l√≠neas: 4
  - Interlineado: factor 0.35
- **Ubicaci√≥n**: 4.5pt, esquina inferior izquierda

**Caracter√≠sticas comunes de todas las configuraciones**:
- Sistema de tama√±os autom√°ticos para c√≥digo y descripci√≥n
- Posiciones Y din√°micas seg√∫n cantidad de l√≠neas
- Fuente: Helvetica Bold
- Alineaci√≥n: Center (c√≥digo y descripci√≥n)
- Fondo blanco, sin bordes (configurables para debug)

**Extensibilidad**: Sistema preparado para agregar nuevas configuraciones f√°cilmente

---

#### **GeneradorCodigoBarra.js**
- **Generaci√≥n de c√≥digos de barras** en formato PNG base64
- **Biblioteca**: `jsbarcode` para crear c√≥digos Code 39
- **Formato**: Code 39 (compatible con esc√°neres industriales)

**Tama√±os configurables** (uso interno): 
- `grande`: height 80, fontSize 26, width 3
- `mediano`: height 60, fontSize 20, width 2
- `chico`: height 40, fontSize 16, width 2

**Caracter√≠sticas**:
- **Fondo blanco**, barras negras
- **No muestra texto inferior** (se agrega manual en el documento)
- **Asteriscos autom√°ticos**: Code 39 los agrega autom√°ticamente
- **Conversi√≥n a may√∫sculas** autom√°tica
- **Validaci√≥n** de caracteres compatibles con Code 39

**Funciones exportadas**:
- `generarCodigoBarraPNG(codigo, tamano)`
- `validarCodigoParaBarra(codigo)`
- `limpiarCodigoParaBarra(codigo)`

**Caracteres v√°lidos Code 39**: A-Z, 0-9, s√≠mbolos: `-`, `.`, `$`, `/`, `+`, `%`, espacio

---

### üìä **Sistema de Base de Datos Excel (breve)**

**El m√≥dulo de etiquetas usa el mismo sistema de base de datos que ubicaciones.**

- **Autocompletado** de descripci√≥n y ubicaci√≥n desde base de datos
- **Verificaci√≥n** de existencia de art√≠culos
- **Detecci√≥n** de art√≠culos inexistentes en la tabla

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üîé **Sistema de B√∫squeda Inteligente (breve)**

**El formulario de etiquetas integra el buscador CodigoMasNombre.vue**

- **B√∫squeda en tiempo real** al escribir c√≥digo
- **Priorizaci√≥n** de resultados exactos
- **Selecci√≥n autom√°tica** con click

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Recordar Ubicaciones (breve)**

**El formulario de etiquetas usa el mismo sistema que ubicaciones**

- **Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **Bot√≥n IconTrash** para limpiar ubicaci√≥n

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Persistencia de Etiquetas**

**Las etiquetas se guardan autom√°ticamente usando `@capacitor/preferences`**

#### **usoAlmacenamientoEtiquetas.js**
- **Ubicaci√≥n**: `src/components/BaseDeDatos/usoAlmacenamientoEtiquetas.js`
- **Clave de almacenamiento**: `historial_etiquetas`

**Funciones exportadas**:
- `guardarEtiquetas(etiquetas)`
- `obtenerEtiquetas()`
- `eliminarEtiquetas()`

**Persistencia autom√°tica**:
- Se guarda al agregar nueva etiqueta
- Se guarda al editar etiqueta existente
- Se guarda al eliminar etiqueta
- Se carga autom√°ticamente al entrar a la p√°gina
- Permite continuar trabajo en sesiones posteriores

**Formato de datos guardados**: `{ id, codigo, descripcion, ubicacion, cantidad, tamano }`

---

### üìÅ **Exportaci√≥n y Compartir**

#### **Nombre de archivo**
- **Formato**: `Etiquetas - [nombre_usuario] - [id_configuracion].pdf`
- **Ejemplo 10x15**: `Etiquetas - Leo - 10x15cm.pdf`
- **Ejemplo 5x10**: `Etiquetas - Leo - 5x10cm.pdf`
- **Ejemplo 2.5x6.7**: `Etiquetas - Leo - 2.5x6.7cm.pdf`

#### **Proceso de exportaci√≥n**:
1. Usuario click en bot√≥n "Enviar"
2. **Loading** con mensaje "Generando documento PDF..."
3. Se genera documento con `GeneradorEtiquetasPDF.js`
4. **En navegador**: Descarga directa del PDF
5. **En m√≥vil**: Se guarda en `Directory.Cache` con Capacitor y se comparte
6. **Notificaci√≥n** de √©xito o error
7. **Las etiquetas NO se borran** despu√©s de generar el PDF

#### **CompartirExcel.js** (reutilizado)
- Mismo m√≥dulo usado en Pedidos y Ubicaciones
- **Share API nativa** de Capacitor
- Compatible con PDF
- Solo se usa en m√≥vil

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **PaginaEtiquetas.vue**
- `mostrarAtras: true`
- `mostrarInicio: true`
- `mostrarAgregar: false`
- `mostrarEnviar: etiquetas.length > 0`

---

### üìä **Detecci√≥n de Problemas**

#### **C√≥digos Duplicados**
- **Detecci√≥n autom√°tica** en TablaEtiquetas
- **Resaltado visual** con fondo naranja
- **Contador** en header de tabla
- **Permite duplicados**: Es v√°lido generar m√∫ltiples etiquetas del mismo art√≠culo

#### **Art√≠culos Inexistentes**
- **Verificaci√≥n** contra base de datos Excel
- **Resaltado visual** con fondo rojo
- **Contador** en header de tabla
- **Permite agregar**: √ötil para art√≠culos nuevos no catalogados

---

### üé® **Caracter√≠sticas de UI/UX**

- **Selector de tama√±o** con radio buttons visuales (3 opciones disponibles)
- **Formulario responsive** con grid adaptativo
- **Tabla responsive** con dise√±o de cards en m√≥vil
- **Controles de cantidad inline** con botones +/-
- **Validaciones con animaciones** de sacudida
- **Feedback visual** para c√≥digos duplicados y art√≠culos inexistentes
- **Loading spinner** durante generaci√≥n de documento
- **Notificaciones** de √©xito/error
- **Confirmaciones** antes de acciones destructivas
- **Iconos consistentes** con @tabler/icons-vue
- **Persistencia visual**: Las etiquetas permanecen despu√©s de generar PDF

---

### üîß **Dependencias Espec√≠ficas**

- **jsPDF**: Generaci√≥n de documentos PDF
- **jsbarcode**: Generaci√≥n de c√≥digos de barras Code 39
- **@capacitor/filesystem**: Guardado de archivos temporales (solo m√≥vil)
- **@capacitor/share**: Compartir archivos generados (solo m√≥vil)
- **@capacitor/preferences**: Persistencia de etiquetas
- **@zxing/library**: Escaneo de c√≥digos (en CamaraEscaneo)
- **@tabler/icons-vue**: Iconograf√≠a

---

### üìù **Notas Importantes**

- Las etiquetas **S√ç se persisten** autom√°ticamente en cada operaci√≥n
- El **tama√±o de fuente del c√≥digo** se ajusta autom√°ticamente seg√∫n longitud
- El **tama√±o de fuente de la descripci√≥n** se ajusta autom√°ticamente seg√∫n longitud
- Los **c√≥digos de barras** son formato Code 39 (est√°ndar industrial)
- El **documento PDF** tiene formato personalizado seg√∫n configuraci√≥n seleccionada
- Hay **tres configuraciones disponibles**: 10x15cm, 5x10cm y 2.5x6.7cm
- Cada etiqueta ocupa **una p√°gina completa** del documento
- Las **copias** se generan como p√°ginas duplicadas consecutivas
- Los **art√≠culos inexistentes** se pueden agregar (√∫til para nuevos productos)
- El **sistema de ubicaciones** es opcional - puede dejarse "Sin ubicaci√≥n"
- El **buscador inteligente** facilita encontrar art√≠culos r√°pidamente
- La **base de datos Excel** debe estar cargada para autocompletado √≥ptimo
- Los **tama√±os del c√≥digo de barras** (chico/mediano/grande) son configuraci√≥n interna
- El **sistema es modular**: F√°cil agregar nuevas configuraciones de tama√±o
- **Funciona en navegador y m√≥vil**: Detecci√≥n autom√°tica de entorno
- El **tama√±o seleccionado** se guarda con cada etiqueta individual
- Los **nombres de archivo** incluyen el nombre de usuario configurado
