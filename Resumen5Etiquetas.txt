### **M√≥dulo de Etiquetas - Bit√°cora II**

Sistema completo para generar etiquetas con c√≥digos de barras Code 39 en documentos PDF personalizados.

---

### üì¶ **Componentes Principales**

#### **PaginaEtiquetas.vue**
- **P√°gina principal** del m√≥dulo de etiquetas
- **Ruta**: `/etiquetas`
- **Header con t√≠tulo** y selector de tama√±o
- **Selector de tama√±o**: Actualmente solo 10x15cm (preparado para futuras medidas)
- **FormularioEtiqueta** para agregar etiquetas
- **TablaEtiquetas** con lista de etiquetas
- **Integraci√≥n con BarraBotonesInferior** para navegaci√≥n
- **Modal de confirmaci√≥n** para eliminar etiquetas
- **Persistencia autom√°tica** de etiquetas
- **Responsive design** adaptativo

#### **FormularioEtiqueta.vue**
- **Formulario completo** para agregar etiquetas
- **Campos**:
  - **C√≥digo del art√≠culo**: Input con buscador inteligente integrado
  - **Descripci√≥n**: Autocompletado desde base de datos
  - **Ubicaci√≥n**: Con formateo autom√°tico y bot√≥n limpiar
  - **Cantidad de copias**: Input num√©rico (m√≠nimo 1)
- **Bot√≥n de c√°mara** para escanear c√≥digos
- **Integraci√≥n con CamaraEscaneo.vue** para m√∫ltiples escaneos
- **Autocompletado completo**: Al seleccionar art√≠culo del buscador, autocompleta descripci√≥n y ubicaci√≥n
- **Validaciones** con feedback visual y animaciones de error
- **‚úÖ Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **‚úÖ Bot√≥n IconTrash** para limpiar ubicaci√≥n cuando cambia de zona

#### **TablaEtiquetas.vue**
- **Lista completa** de etiquetas agregadas
- **Header con contadores**:
  - Etiquetas totales
  - Copias totales
  - C√≥digos repetidos (si hay)
  - Art√≠culos inexistentes (si hay)
- **Columnas**:
  - **Nombre y C√≥digo**: Muestra nombre de la base de datos + c√≥digo
  - **Ubicaci√≥n**: Ubicaci√≥n del art√≠culo
  - **Cantidad**: Control inline con botones +/-
  - **Acciones**: Editar y eliminar
- **‚úÖ Detecci√≥n de c√≥digos duplicados** (fondo naranja)
- **‚úÖ Detecci√≥n de art√≠culos inexistentes** (fondo rojo)
- **Controles de cantidad inline**: Incrementar/decrementar sin modal
- **‚úÖ Modal personalizado para confirmar limpieza**: Usa ModalEliminar en lugar de confirm() nativo
- **Bot√≥n limpiar todo** con confirmaci√≥n
- **Responsive** con dise√±o de cards en m√≥vil
- **Integraci√≥n con base de datos** para mostrar nombres

#### **ModalEditarEtiqueta.vue**
- **Modal para editar** etiquetas existentes
- **Campos editables**: c√≥digo, descripci√≥n, ubicaci√≥n, cantidad
- **Validaciones** completas con feedback visual
- **Botones**: guardar y cancelar
- **Integraci√≥n** con sistema de etiquetas

---

### üìÑ **Sistema de Generaci√≥n de Documentos**

#### **GeneradorEtiquetasPDF.js**
- **Motor principal** para generar documentos PDF
- **Biblioteca**: `jsPDF` para crear archivos PDF
- **Configuraci√≥n modular**: Usa archivos de configuraci√≥n externos
- **Dimensiones personalizadas**: Cada configuraci√≥n define tama√±o de p√°gina
- **Layout adaptativo**: Ajusta elementos seg√∫n configuraci√≥n

**Contenido por etiqueta** (una p√°gina por etiqueta):
1. **C√≥digo del art√≠culo**: Posici√≥n, fuente y tama√±o configurables
2. **C√≥digo de barras**: PNG generado por GeneradorCodigoBarra.js
3. **Descripci√≥n**: 
   - **Tama√±o autom√°tico**: Ajuste inteligente seg√∫n longitud del texto
   - **Multil√≠nea**: Divisi√≥n autom√°tica de texto largo
   - **Interlineado configurable**
   - **M√°ximo de l√≠neas configurable**
4. **Ubicaci√≥n**: Posici√≥n configurable (por defecto esquina inferior izquierda)

**Sistema de tama√±o autom√°tico de descripci√≥n**:
- Eval√∫a longitud del texto
- Aplica tama√±os seg√∫n rangos configurados
- Sistema de 7 niveles (muy corta a gigante)
- Posicionamiento din√°mico seg√∫n cantidad de l√≠neas

**Caracter√≠sticas avanzadas**:
- **Salto de p√°gina** autom√°tico entre etiquetas
- **Respeta cantidad de copias**: Genera p√°ginas duplicadas
- **Guardado temporal** con `@capacitor/filesystem` en `Directory.Cache`
- **Conversi√≥n a base64** para compatibilidad con Capacitor
- **Retorna**: URI del archivo + nombre del archivo

**Funci√≥n principal**: `generarDocumentoEtiquetas(listaEtiquetas, configuracion)`

#### **ConfiguracionEtiqueta10x15.js**
- **Archivo de configuraci√≥n** para etiquetas de 10x15 cm
- **Sistema modular**: Permite agregar f√°cilmente nuevas configuraciones

**Secciones de configuraci√≥n**:
1. **Identificaci√≥n**: nombre: '10x15 cm', id: '10x15cm'
2. **Dimensiones de p√°gina**: ancho: 150mm, alto: 100mm, m√°rgenes: 4mm
3. **C√≥digo del art√≠culo**: tama√±o: 50pt, fuente: helvetica bold, posici√≥n Y: 15mm
4. **C√≥digo de barras**: ancho: 80mm, alto: 25mm, posici√≥n Y: 30mm, centrado: true
5. **Descripci√≥n**: 
   - **Tama√±os autom√°ticos** (7 niveles seg√∫n longitud)
   - fuente: helvetica bold
   - anchoMaximo: 90mm
   - interlineadoFactor: 0.35
   - maximoLineas: 7
   - **Posiciones Y din√°micas** seg√∫n cantidad de l√≠neas (1-7)
6. **Ubicaci√≥n**: tama√±o: 10pt, posici√≥n esquina inferior izquierda
7. **Extras**: mostrarBordes, colorFondo, mostrarGuias (para desarrollo)

**Extensibilidad**: Preparado para agregar nuevas configuraciones

#### **GeneradorCodigoBarra.js**
- **Generaci√≥n de c√≥digos de barras** en formato PNG base64
- **Biblioteca**: `jsbarcode` para crear c√≥digos Code 39
- **Formato**: Code 39 (compatible con esc√°neres industriales)

**Tama√±os configurables** (uso interno): grande, mediano, chico

**Caracter√≠sticas**:
- **Fondo blanco**, barras negras
- **No muestra texto inferior** (se agrega manual en el documento)
- **Asteriscos autom√°ticos**: Code 39 los agrega autom√°ticamente
- **Conversi√≥n a may√∫sculas** autom√°tica
- **Validaci√≥n** de caracteres compatibles con Code 39

**Funciones exportadas**:
- `generarCodigoBarraPNG(codigo, tamano)`
- `validarCodigoParaBarra(codigo)`
- `limpiarCodigoParaBarra(codigo)`

**Caracteres v√°lidos Code 39**: A-Z, 0-9, s√≠mbolos: `-`, `.`, `$`, `/`, `+`, `%`, espacio

---

### üìä **Sistema de Base de Datos Excel (breve)**

**El m√≥dulo de etiquetas usa el mismo sistema de base de datos que ubicaciones.**

- **Autocompletado** de descripci√≥n y ubicaci√≥n desde base de datos
- **Verificaci√≥n** de existencia de art√≠culos
- **Detecci√≥n** de art√≠culos inexistentes en la tabla

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üîé **Sistema de B√∫squeda Inteligente (breve)**

**El formulario de etiquetas integra el buscador CodigoMasNombre.vue**

- **B√∫squeda en tiempo real** al escribir c√≥digo
- **Priorizaci√≥n** de resultados exactos
- **Selecci√≥n autom√°tica** con click

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Recordar Ubicaciones (breve)**

**El formulario de etiquetas usa el mismo sistema que ubicaciones**

- **Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **Bot√≥n IconTrash** para limpiar ubicaci√≥n

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Persistencia de Etiquetas**

**Las etiquetas se guardan autom√°ticamente usando `@capacitor/preferences`**

#### **usoAlmacenamientoEtiquetas.js**
- **Ubicaci√≥n**: `src/components/BaseDeDatos/usoAlmacenamientoEtiquetas.js`
- **Clave de almacenamiento**: `historial_etiquetas`

**Funciones exportadas**:
- `guardarEtiquetas(etiquetas)`
- `obtenerEtiquetas()`
- `eliminarEtiquetas()`

**Persistencia autom√°tica**:
- Se guarda al agregar nueva etiqueta
- Se guarda al editar etiqueta existente
- Se guarda al eliminar etiqueta
- Se carga autom√°ticamente al entrar a la p√°gina
- Permite continuar trabajo en sesiones posteriores

**Formato de datos guardados**: `{ id, codigo, descripcion, ubicacion, cantidad, tamano }`

---

### üìÅ **Exportaci√≥n y Compartir**

#### **Nombre de archivo**
- **Formato**: `etiquetas_[id_configuracion]_[timestamp].pdf`

#### **Proceso de exportaci√≥n**:
1. Usuario click en bot√≥n "Enviar"
2. **Loading** con mensaje "Generando documento PDF..."
3. Se genera documento con `GeneradorEtiquetasPDF.js`
4. Se guarda en `Directory.Cache` con Capacitor
5. Se comparte con **Share API** nativa de Capacitor
6. **Notificaci√≥n** de √©xito o error
7. **Las etiquetas NO se borran** despu√©s de generar el PDF

#### **CompartirExcel.js** (reutilizado)
- Mismo m√≥dulo usado en Pedidos y Ubicaciones
- **Share API nativa** de Capacitor
- Compatible con PDF

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **PaginaEtiquetas.vue**
- `mostrarAtras: true`
- `mostrarInicio: true`
- `mostrarAgregar: false`
- `mostrarEnviar: etiquetas.length > 0`

---

### üìä **Detecci√≥n de Problemas**

#### **C√≥digos Duplicados**
- **Detecci√≥n autom√°tica** en TablaEtiquetas
- **Resaltado visual** con fondo naranja
- **Contador** en header de tabla
- **Permite duplicados**: Es v√°lido generar m√∫ltiples etiquetas del mismo art√≠culo

#### **Art√≠culos Inexistentes**
- **Verificaci√≥n** contra base de datos Excel
- **Resaltado visual** con fondo rojo
- **Contador** en header de tabla
- **Permite agregar**: √ötil para art√≠culos nuevos no catalogados

---

### üé® **Caracter√≠sticas de UI/UX**

- **Selector de tama√±o** con radio buttons visuales (preparado para futuras medidas)
- **Formulario responsive** con grid adaptativo
- **Tabla responsive** con dise√±o de cards en m√≥vil
- **Controles de cantidad inline** con botones +/-
- **Validaciones con animaciones** de sacudida
- **Feedback visual** para c√≥digos duplicados y art√≠culos inexistentes
- **Loading spinner** durante generaci√≥n de documento
- **Notificaciones** de √©xito/error
- **Confirmaciones** antes de acciones destructivas
- **Iconos consistentes** con @tabler/icons-vue
- **Persistencia visual**: Las etiquetas permanecen despu√©s de generar PDF

---

### üîß **Dependencias Espec√≠ficas**

- **jsPDF**: Generaci√≥n de documentos PDF
- **jsbarcode**: Generaci√≥n de c√≥digos de barras Code 39
- **@capacitor/filesystem**: Guardado de archivos temporales
- **@capacitor/share**: Compartir archivos generados
- **@capacitor/preferences**: Persistencia de etiquetas
- **@zxing/library**: Escaneo de c√≥digos (en CamaraEscaneo)
- **@tabler/icons-vue**: Iconograf√≠a

---

### üìù **Notas Importantes**

- Las etiquetas **S√ç se persisten** autom√°ticamente en cada operaci√≥n
- El **tama√±o de fuente** de la descripci√≥n se ajusta autom√°ticamente seg√∫n longitud
- Los **c√≥digos de barras** son formato Code 39 (est√°ndar industrial)
- El **documento PDF** tiene formato personalizado seg√∫n configuraci√≥n
- Actualmente solo hay **una configuraci√≥n**: 10x15cm (m√°s medidas en el futuro)
- Cada etiqueta ocupa **una p√°gina completa** del documento
- Las **copias** se generan como p√°ginas duplicadas consecutivas
- Los **art√≠culos inexistentes** se pueden agregar (√∫til para nuevos productos)
- El **sistema de ubicaciones** es opcional - puede dejarse "Sin ubicaci√≥n"
- El **buscador inteligente** facilita encontrar art√≠culos r√°pidamente
- La **base de datos Excel** debe estar cargada para autocompletado √≥ptimo
- Los **tama√±os del c√≥digo de barras** (chico/mediano/grande) son configuraci√≥n interna
- El **sistema es modular**: F√°cil agregar nuevas configuraciones de tama√±o
