### **M√≥dulo de Etiquetas - Bit√°cora II**

Sistema completo para generar etiquetas con c√≥digos de barras Code 39 en documentos PDF personalizados.

---

### üì¶ **Componentes Principales**

#### **PaginaEtiquetas.vue**
- **P√°gina principal** del m√≥dulo de etiquetas
- **Ruta**: `/etiquetas`
- **Header con t√≠tulo** y selector de tama√±o
- **Selector de tama√±o**: Actualmente solo 10x15cm (preparado para futuras medidas)
- **FormularioEtiqueta** para agregar etiquetas
- **TablaEtiquetas** con lista de etiquetas
- **Integraci√≥n con BarraBotonesInferior** para navegaci√≥n
- **Modal de confirmaci√≥n** para eliminar etiquetas
- **Persistencia autom√°tica** de etiquetas
- **Responsive design** adaptativo

#### **FormularioEtiqueta.vue**
- **Formulario completo** para agregar etiquetas
- **Campos**:
  - **C√≥digo del art√≠culo**: Input con buscador inteligente integrado
  - **Descripci√≥n**: Autocompletado desde base de datos
  - **Ubicaci√≥n**: Con formateo autom√°tico y bot√≥n limpiar
  - **Cantidad de copias**: Input num√©rico (m√≠nimo 1)
- **Bot√≥n de c√°mara** para escanear c√≥digos
- **Integraci√≥n con CamaraEscaneo.vue** para m√∫ltiples escaneos
- **Autocompletado completo**: Al seleccionar art√≠culo del buscador, autocompleta descripci√≥n y ubicaci√≥n
- **Validaciones** con feedback visual y animaciones de error
- **‚úÖ Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **‚úÖ Bot√≥n IconTrash** para limpiar ubicaci√≥n cuando cambia de zona

**Workflow del formulario**:
1. Escanear o escribir c√≥digo ‚Üí Buscador se activa
2. Seleccionar art√≠culo ‚Üí Autocompleta descripci√≥n y ubicaci√≥n
3. Ajustar cantidad de copias
4. Agregar ‚Üí Limpia formulario y mantiene foco

#### **TablaEtiquetas.vue**
- **Lista completa** de etiquetas agregadas
- **Header con contadores**:
  - Etiquetas totales
  - Copias totales
  - C√≥digos repetidos (si hay)
  - Art√≠culos inexistentes (si hay)
- **Columnas**:
  - **Nombre y C√≥digo**: Muestra nombre de la base de datos + c√≥digo
  - **Ubicaci√≥n**: Ubicaci√≥n del art√≠culo
  - **Cantidad**: Control inline con botones +/-
  - **Acciones**: Editar y eliminar
- **‚úÖ Detecci√≥n de c√≥digos duplicados** (fondo naranja)
- **‚úÖ Detecci√≥n de art√≠culos inexistentes** (fondo rojo)
- **Controles de cantidad inline**: Incrementar/decrementar sin modal
- **‚úÖ Modal personalizado para confirmar limpieza**: Usa ModalEliminar en lugar de confirm() nativo
- **Bot√≥n limpiar todo** con confirmaci√≥n
- **Responsive** con dise√±o de cards en m√≥vil
- **Integraci√≥n con base de datos** para mostrar nombres

#### **ModalEditarEtiqueta.vue**
- **Modal para editar** etiquetas existentes
- **Campos editables**: c√≥digo, descripci√≥n, ubicaci√≥n, cantidad
- **Validaciones** completas con feedback visual
- **Botones**: guardar y cancelar
- **Integraci√≥n** con sistema de etiquetas

---

### üìÑ **Sistema de Generaci√≥n de Documentos**

#### **GeneradorEtiquetasPDF.js**
- **Motor principal** para generar documentos PDF
- **Biblioteca**: `jsPDF` para crear archivos PDF

**Caracter√≠sticas del sistema**:
- **Configuraci√≥n modular**: Usa archivos de configuraci√≥n externos (ConfiguracionEtiqueta10x15.js)
- **Dimensiones personalizadas**: Cada configuraci√≥n define tama√±o de p√°gina
- **Layout adaptativo**: Ajusta elementos seg√∫n configuraci√≥n

**Contenido por etiqueta** (una p√°gina por etiqueta):
1. **C√≥digo del art√≠culo**:
   - Posici√≥n: Seg√∫n configuraci√≥n
   - Fuente: Configurable (por defecto Arial, bold)
   - Tama√±o: Configurable (por defecto 50pt)
   - Alineaci√≥n: Centrado

2. **C√≥digo de barras**:
   - Posici√≥n: Configurable
   - Formato: PNG generado por GeneradorCodigoBarra.js
   - Dimensiones: Seg√∫n configuraci√≥n
   - Centrado: Opcional

3. **Descripci√≥n**:
   - Posici√≥n: Din√°mica seg√∫n cantidad de l√≠neas
   - Fuente: Configurable (por defecto Arial, bold)
   - **Tama√±o autom√°tico**: Ajuste inteligente seg√∫n longitud del texto
   - **Multil√≠nea**: Divisi√≥n autom√°tica de texto largo
   - **Interlineado configurable**: Factor de espaciado entre l√≠neas
   - **M√°ximo de l√≠neas**: Configurable (por defecto 7)

4. **Ubicaci√≥n**:
   - Posici√≥n: Configurable (por defecto esquina inferior izquierda)
   - Fuente: Configurable (por defecto Arial, 10pt)
   - Tama√±o: Configurable

**Sistema de tama√±o autom√°tico de descripci√≥n**:
- Eval√∫a longitud del texto
- Aplica tama√±os seg√∫n rangos configurados
- Sistema de 7 niveles (muy corta a gigante)
- Posicionamiento din√°mico seg√∫n cantidad de l√≠neas

**Caracter√≠sticas avanzadas**:
- **Salto de p√°gina** autom√°tico entre etiquetas
- **Respeta cantidad de copias**: Genera p√°ginas duplicadas
- **Guardado temporal** con `@capacitor/filesystem` en `Directory.Cache`
- **Conversi√≥n a base64** para compatibilidad con Capacitor
- **Retorna**: URI del archivo + nombre del archivo

**Funci√≥n principal**:
```javascript
generarDocumentoEtiquetas(listaEtiquetas, configuracion)
// Retorna: { exito, mensaje, rutaArchivo, nombreArchivo }
```

#### **ConfiguracionEtiqueta10x15.js**
- **Archivo de configuraci√≥n** para etiquetas de 10x15 cm
- **Sistema modular**: Permite agregar f√°cilmente nuevas configuraciones

**Secciones de configuraci√≥n**:
1. **Identificaci√≥n**:
   - nombre: '10x15 cm'
   - id: '10x15cm'

2. **Dimensiones de p√°gina**:
   - ancho: 150mm (15cm)
   - alto: 100mm (10cm)
   - m√°rgenes: 4mm todos los lados

3. **C√≥digo del art√≠culo**:
   - tama√±o: 50pt
   - fuente: helvetica bold
   - posici√≥n Y: 15mm

4. **C√≥digo de barras**:
   - ancho: 80mm
   - alto: 25mm
   - posici√≥n Y: 30mm
   - centrado: true
   - tama√±o: 'grande' (para GeneradorCodigoBarra.js)

5. **Descripci√≥n**:
   - **Tama√±os autom√°ticos** (7 niveles):
     - Muy corta (‚â§15 chars): 60pt
     - Corta (‚â§25 chars): 52pt
     - Mediana (‚â§35 chars): 46pt
     - Larga (‚â§45 chars): 40pt
     - Muy larga (‚â§60 chars): 34pt
     - Extra larga (‚â§80 chars): 28pt
     - Gigante (>80 chars): 24pt
   - fuente: helvetica bold
   - anchoMaximo: 90mm
   - interlineadoFactor: 0.35
   - maximoLineas: 7
   - **Posiciones Y din√°micas** seg√∫n cantidad de l√≠neas (1-7)

6. **Ubicaci√≥n**:
   - tama√±o: 10pt
   - fuente: helvetica normal
   - posici√≥n X: 4mm
   - posici√≥n Y: 146mm (esquina inferior izquierda)

7. **Extras**:
   - mostrarBordes: false (para debug)
   - colorFondo: RGB blanco
   - mostrarGuias: false (para desarrollo)

**Extensibilidad**:
- Preparado para agregar nuevas configuraciones
- Sistema plug-and-play para diferentes tama√±os

#### **GeneradorCodigoBarra.js**
- **Generaci√≥n de c√≥digos de barras** en formato PNG base64
- **Biblioteca**: `jsbarcode` para crear c√≥digos Code 39
- **Formato**: Code 39 (compatible con esc√°neres industriales)

**Tama√±os configurables** (uso interno):
```javascript
grande: {
  height: 80,
  fontSize: 26,
  width: 3,
  margin: 10
}
mediano: {
  height: 60,
  fontSize: 20,
  width: 2,
  margin: 8
}
chico: {
  height: 40,
  fontSize: 16,
  width: 2,
  margin: 5
}
```

**Caracter√≠sticas**:
- **Fondo blanco**, barras negras
- **No muestra texto inferior** (se agrega manual en el documento)
- **Asteriscos autom√°ticos**: Code 39 los agrega autom√°ticamente
- **Conversi√≥n a may√∫sculas** autom√°tica
- **Validaci√≥n** de caracteres compatibles con Code 39

**Funciones exportadas**:
```javascript
generarCodigoBarraPNG(codigo, tamano)       // Genera PNG base64
validarCodigoParaBarra(codigo)              // Valida compatibilidad
limpiarCodigoParaBarra(codigo)              // Limpia caracteres inv√°lidos
```

**Caracteres v√°lidos Code 39**:
- A-Z, 0-9
- S√≠mbolos: `-`, `.`, `$`, `/`, `+`, `%`, espacio

---

### üìä **Sistema de Base de Datos Excel (breve)**

**El m√≥dulo de etiquetas usa el mismo sistema de base de datos que ubicaciones.**

- **Autocompletado** de descripci√≥n y ubicaci√≥n desde base de datos
- **Verificaci√≥n** de existencia de art√≠culos
- **Detecci√≥n** de art√≠culos inexistentes en la tabla

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üîé **Sistema de B√∫squeda Inteligente (breve)**

**El formulario de etiquetas integra el buscador CodigoMasNombre.vue**

- **B√∫squeda en tiempo real** al escribir c√≥digo
- **Priorizaci√≥n** de resultados exactos
- **Selecci√≥n autom√°tica** con click

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Recordar Ubicaciones (breve)**

**El formulario de etiquetas usa el mismo sistema que ubicaciones**

- **Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **Bot√≥n IconTrash** para limpiar ubicaci√≥n

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Persistencia de Etiquetas**

**Las etiquetas se guardan autom√°ticamente usando `@capacitor/preferences`**

#### **usoAlmacenamientoEtiquetas.js**
- **Ubicaci√≥n**: `src/components/BaseDeDatos/usoAlmacenamientoEtiquetas.js`
- **Clave de almacenamiento**: `historial_etiquetas`

**Funciones exportadas**:
```javascript
guardarEtiquetas(etiquetas)      // Guarda array de etiquetas
obtenerEtiquetas()               // Retorna array de etiquetas guardadas
eliminarEtiquetas()              // Borra todas las etiquetas del storage
```

**Persistencia autom√°tica**:
- Se guarda al agregar nueva etiqueta
- Se guarda al editar etiqueta existente
- Se guarda al eliminar etiqueta
- Se carga autom√°ticamente al entrar a la p√°gina
- Permite continuar trabajo en sesiones posteriores

**Formato de datos guardados**:
```javascript
[
  {
    id: 1704067200000,
    codigo: "ABC123",
    descripcion: "Producto 1",
    ubicacion: "A-1-2",
    cantidad: 2,
    tamano: "10x15cm"
  },
  // ... m√°s etiquetas
]
```

---

### üìÅ **Exportaci√≥n y Compartir**

#### **Nombre de archivo**
- **Formato**: `etiquetas_[id_configuracion]_[timestamp].pdf`
- **Ejemplo**: `etiquetas_10x15cm_1704067200000.pdf`

#### **Proceso de exportaci√≥n**:
1. Usuario click en bot√≥n "Enviar"
2. **Loading** con mensaje "Generando documento PDF..."
3. Se genera documento con `GeneradorEtiquetasPDF.js`
4. Se guarda en `Directory.Cache` con Capacitor
5. Se comparte con **Share API** nativa de Capacitor
6. **Notificaci√≥n** de √©xito o error
7. **Las etiquetas NO se borran** despu√©s de generar el PDF

#### **CompartirExcel.js** (reutilizado)
- Mismo m√≥dulo usado en Pedidos y Ubicaciones
- **Share API nativa** de Capacitor
- Compatible con PDF

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **PaginaEtiquetas.vue**
```javascript
configuracionBarra: {
  mostrarAtras: true,
  mostrarInicio: true,
  mostrarAgregar: false,
  mostrarEnviar: etiquetas.length > 0,
  puedeEnviar: etiquetas.length > 0,
  botonesPersonalizados: []
}
```

---

### ‚úÖ **Flujo de Trabajo T√≠pico**

1. **Cargar etiquetas guardadas**:
   - Al entrar a la p√°gina se cargan etiquetas de sesiones anteriores
   - Permite continuar trabajo pendiente

2. **Agregar etiquetas manualmente**:
   - Escribir c√≥digo ‚Üí Se activa buscador
   - Seleccionar art√≠culo ‚Üí Autocompleta todo
   - Ajustar cantidad de copias (si necesita m√°s de 1)
   - Click en agregar
   - **Se guarda autom√°ticamente**

3. **Agregar etiquetas con c√°mara**:
   - Click en bot√≥n c√°mara
   - Escanear c√≥digo
   - Sistema busca en base de datos
   - Autocompleta descripci√≥n y ubicaci√≥n
   - Ajustar cantidad
   - Agregar
   - **Se guarda autom√°ticamente**

4. **Editar etiquetas**:
   - Click en icono l√°piz
   - Modificar campos necesarios
   - Guardar
   - **Se guarda autom√°ticamente**

5. **Ajustar cantidades**:
   - Usar botones +/- directamente en la tabla
   - O editar n√∫mero manualmente
   - **Se guarda autom√°ticamente**

6. **Generar documento PDF**:
   - Click en bot√≥n "Enviar"
   - Esperar generaci√≥n
   - Compartir con app deseada (WhatsApp, Gmail, Drive, etc.)
   - **Las etiquetas permanecen guardadas**

7. **Limpiar todo**:
   - Click en bot√≥n limpiar (icono basura)
   - Confirmar en modal
   - **Se elimina del almacenamiento**

---

### üìä **Estructura de Datos**

#### **Etiqueta Individual**
```javascript
{
  id: timestamp,                    // ID √∫nico
  codigo: "ABC123",                 // c√≥digo del art√≠culo
  descripcion: "Nombre producto",   // descripci√≥n/nombre
  ubicacion: "A-1-2",              // ubicaci√≥n f√≠sica
  cantidad: 3,                      // cantidad de copias
  tamano: "10x15cm"                 // tama√±o seleccionado
}
```

#### **Array de Etiquetas (persistido)**
```javascript
[
  { 
    id: 1704067200000, 
    codigo: "ABC123", 
    descripcion: "Producto 1", 
    ubicacion: "A-1-2", 
    cantidad: 2, 
    tamano: "10x15cm" 
  },
  { 
    id: 1704067201000, 
    codigo: "XYZ789", 
    descripcion: "Producto 2", 
    ubicacion: "B-3-1", 
    cantidad: 1, 
    tamano: "10x15cm" 
  }
]
```

---

### üìä **Detecci√≥n de Problemas**

#### **C√≥digos Duplicados**
- **Detecci√≥n autom√°tica** en TablaEtiquetas
- **Resaltado visual** con fondo naranja
- **Contador** en header de tabla
- **Permite duplicados**: Es v√°lido generar m√∫ltiples etiquetas del mismo art√≠culo

#### **Art√≠culos Inexistentes**
- **Verificaci√≥n** contra base de datos Excel
- **Resaltado visual** con fondo rojo
- **Contador** en header de tabla
- **Permite agregar**: √ötil para art√≠culos nuevos no catalogados

---

### üé® **Caracter√≠sticas de UI/UX**

- **Selector de tama√±o** con radio buttons visuales (preparado para futuras medidas)
- **Formulario responsive** con grid adaptativo
- **Tabla responsive** con dise√±o de cards en m√≥vil
- **Controles de cantidad inline** con botones +/-
- **Validaciones con animaciones** de sacudida
- **Feedback visual** para c√≥digos duplicados y art√≠culos inexistentes
- **Loading spinner** durante generaci√≥n de documento
- **Notificaciones** de √©xito/error
- **Confirmaciones** antes de acciones destructivas
- **Iconos consistentes** con @tabler/icons-vue
- **Persistencia visual**: Las etiquetas permanecen despu√©s de generar PDF

---

### üîß **Dependencias Espec√≠ficas**

- **jsPDF**: Generaci√≥n de documentos PDF
- **jsbarcode**: Generaci√≥n de c√≥digos de barras Code 39
- **@capacitor/filesystem**: Guardado de archivos temporales
- **@capacitor/share**: Compartir archivos generados
- **@capacitor/preferences**: Persistencia de etiquetas
- **@zxing/library**: Escaneo de c√≥digos (en CamaraEscaneo)
- **@tabler/icons-vue**: Iconograf√≠a

---

### üìù **Notas Importantes**

- Las etiquetas **S√ç se persisten** autom√°ticamente en cada operaci√≥n
- El **tama√±o de fuente** de la descripci√≥n se ajusta autom√°ticamente seg√∫n longitud
- Los **c√≥digos de barras** son formato Code 39 (est√°ndar industrial)
- El **documento PDF** tiene formato personalizado seg√∫n configuraci√≥n
- Actualmente solo hay **una configuraci√≥n**: 10x15cm (m√°s medidas en el futuro)
- Cada etiqueta ocupa **una p√°gina completa** del documento
- Las **copias** se generan como p√°ginas duplicadas consecutivas
- Los **art√≠culos inexistentes** se pueden agregar (√∫til para nuevos productos)
- El **sistema de ubicaciones** es opcional - puede dejarse "Sin ubicaci√≥n"
- El **buscador inteligente** facilita encontrar art√≠culos r√°pidamente
- La **base de datos Excel** debe estar cargada para autocompletado √≥ptimo
- Los **tama√±os del c√≥digo de barras** (chico/mediano/grande) son configuraci√≥n interna
- El **sistema es modular**: F√°cil agregar nuevas configuraciones de tama√±o