### **M√≥dulo de Etiquetas - Bit√°cora II**

Sistema completo para generar etiquetas con c√≥digos de barras Code 39 en documentos Word personalizados.

---

### üì¶ **Componentes Principales**

#### **PaginaEtiquetas.vue**
- **P√°gina principal** del m√≥dulo de etiquetas
- **Ruta**: `/etiquetas`
- **Header con t√≠tulo** y selector de tama√±o
- **Selector de tama√±o**: Chico, Mediano, Grande (default: Grande)
- **FormularioEtiqueta** para agregar etiquetas
- **TablaEtiquetas** con lista de etiquetas
- **Integraci√≥n con BarraBotonesInferior** para navegaci√≥n
- **Modal de confirmaci√≥n** para eliminar etiquetas
- **Responsive design** adaptativo

#### **FormularioEtiqueta.vue**
- **Formulario completo** para agregar etiquetas
- **Campos**:
  - **C√≥digo del art√≠culo**: Input con buscador inteligente integrado
  - **Descripci√≥n**: Autocompletado desde base de datos
  - **Ubicaci√≥n**: Con formateo autom√°tico y bot√≥n limpiar
  - **Cantidad de copias**: Input num√©rico (m√≠nimo 1)
- **Bot√≥n de c√°mara** para escanear c√≥digos
- **Integraci√≥n con CamaraEscaneo.vue** para m√∫ltiples escaneos
- **Autocompletado completo**: Al seleccionar art√≠culo del buscador, autocompleta descripci√≥n y ubicaci√≥n
- **Validaciones** con feedback visual y animaciones de error
- **‚úÖ Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **‚úÖ Bot√≥n IconTrash** para limpiar ubicaci√≥n cuando cambia de zona

**Workflow del formulario**:
1. Escanear o escribir c√≥digo ‚Üí Buscador se activa
2. Seleccionar art√≠culo ‚Üí Autocompleta descripci√≥n y ubicaci√≥n
3. Ajustar cantidad de copias
4. Agregar ‚Üí Limpia formulario y mantiene foco

#### **TablaEtiquetas.vue**
- **Lista completa** de etiquetas agregadas
- **Header con contadores**:
  - Etiquetas totales
  - Copias totales
  - C√≥digos repetidos (si hay)
  - Art√≠culos inexistentes (si hay)
- **Columnas**:
  - **Nombre y C√≥digo**: Muestra nombre de la base de datos + c√≥digo
  - **Ubicaci√≥n**: Ubicaci√≥n del art√≠culo
  - **Cantidad**: Control inline con botones +/-
  - **Acciones**: Editar y eliminar
- **‚úÖ Detecci√≥n de c√≥digos duplicados** (fondo naranja)
- **‚úÖ Detecci√≥n de art√≠culos inexistentes** (fondo rojo)
- **Controles de cantidad inline**: Incrementar/decrementar sin modal
- **‚úÖ Modal personalizado para confirmar limpieza**: Usa ModalEliminar en lugar de confirm() nativo
- **Bot√≥n limpiar todo** con confirmaci√≥n
- **Responsive** con dise√±o de cards en m√≥vil
- **Integraci√≥n con base de datos** para mostrar nombres

#### **ModalEditarEtiqueta.vue**
- **Modal para editar** etiquetas existentes
- **Campos editables**: c√≥digo, descripci√≥n, ubicaci√≥n, cantidad
- **Validaciones** completas con feedback visual
- **Botones**: guardar y cancelar
- **Integraci√≥n** con sistema de etiquetas

---

### üìÑ **Sistema de Generaci√≥n de Documentos**

#### **GeneradorEtiquetasWord.js**
- **Motor principal** para generar documentos Word
- **Biblioteca**: `docx` para crear archivos .docx

**Formato de p√°gina personalizado**:
- **Tama√±o**: 10cm x 15cm
- **M√°rgenes**: 5mm en todos los lados
- **Orientaci√≥n**: Vertical

**Contenido por etiqueta** (una p√°gina por etiqueta):
1. **C√≥digo del art√≠culo**:
   - Posici√≥n: Arriba, centrado
   - Fuente: Arial, 50pt, bold
   - Espaciado: 200 before, 100 after

2. **C√≥digo de barras**:
   - Posici√≥n: Centro
   - Formato: PNG (280x100 pixels)
   - Espaciado: 100 before, 100 after

3. **Descripci√≥n**:
   - Posici√≥n: Centro
   - Fuente: Arial, **tama√±o autom√°tico 40-60pt** seg√∫n longitud
   - Bold: S√≠
   - Espaciado: 150 before, 400 after

4. **Ubicaci√≥n**:
   - Posici√≥n: Esquina inferior izquierda
   - Fuente: Arial, 10pt
   - Espaciado: 600 before

**L√≥gica de tama√±o autom√°tico de descripci√≥n**:
longitud ‚â§ 15 ‚Üí 60pt  // Descripciones cortas
longitud ‚â§ 25 ‚Üí 52pt  // Descripciones medianas
longitud ‚â§ 35 ‚Üí 46pt  // Descripciones un poco largas
longitud ‚â§ 45 ‚Üí 42pt  // Descripciones largas
longitud > 45 ‚Üí 40pt  // Descripciones muy largas

**Caracter√≠sticas**:
- **Salto de p√°gina** autom√°tico entre etiquetas
- **Respeta cantidad de copias**: Genera p√°ginas duplicadas
- **Guardado temporal** con `@capacitor/filesystem` en `Directory.Cache`
- **Retorna**: URI del archivo + nombre del archivo

**Funci√≥n principal**:
generarDocumentoEtiquetas(listaEtiquetas)
// Retorna: { exito, mensaje, rutaArchivo, nombreArchivo }

#### **GeneradorCodigoBarra.js**
- **Generaci√≥n de c√≥digos de barras** en formato PNG base64
- **Biblioteca**: `jsbarcode` para crear c√≥digos Code 39
- **Formato**: Code 39 (compatible con esc√°neres industriales)

**Tama√±os configurables**:
grande: {
  height: 80,
  fontSize: 26,
  width: 3,
  margin: 10
}
mediano: {
  height: 60,
  fontSize: 20,
  width: 2,
  margin: 8
}
chico: {
  height: 40,
  fontSize: 16,
  width: 2,
  margin: 5
}

**Caracter√≠sticas**:
- **Fondo blanco**, barras negras
- **No muestra texto inferior** (se agrega manual en el documento)
- **Asteriscos autom√°ticos**: Code 39 los agrega autom√°ticamente
- **Conversi√≥n a may√∫sculas** autom√°tica
- **Validaci√≥n** de caracteres compatibles con Code 39

**Funciones exportadas**:
generarCodigoBarraPNG(codigo, tamano)       // Genera PNG base64
validarCodigoParaBarra(codigo)              // Valida compatibilidad
limpiarCodigoParaBarra(codigo)              // Limpia caracteres inv√°lidos

**Caracteres v√°lidos Code 39**:
- A-Z, 0-9
- S√≠mbolos: `-`, `.`, `$`, `/`, `+`, `%`, espacio

---

### üìä **Sistema de Base de Datos Excel (breve)**

**El m√≥dulo de etiquetas usa el mismo sistema de base de datos que ubicaciones.**

- **Autocompletado** de descripci√≥n y ubicaci√≥n desde base de datos
- **Verificaci√≥n** de existencia de art√≠culos
- **Detecci√≥n** de art√≠culos inexistentes en la tabla

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üîé **Sistema de B√∫squeda Inteligente (breve)**

**El formulario de etiquetas integra el buscador CodigoMasNombre.vue**

- **B√∫squeda en tiempo real** al escribir c√≥digo
- **Priorizaci√≥n** de resultados exactos
- **Selecci√≥n autom√°tica** con click

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üíæ **Sistema de Recordar Ubicaciones (breve)**

**El formulario de etiquetas usa el mismo sistema que ubicaciones**

- **Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **Bot√≥n IconTrash** para limpiar ubicaci√≥n

**Para informaci√≥n completa**, ver: `ResumenUbicaciones.txt`

---

### üìÅ **Exportaci√≥n y Compartir**

#### **Nombre de archivo**
- **Formato**: `etiquetas_[timestamp].docx`
- **Ejemplo**: `etiquetas_1704067200000.docx`

#### **Proceso de exportaci√≥n**:
1. Usuario click en bot√≥n "Enviar"
2. **Loading** con mensaje "Generando documento Word..."
3. Se genera documento con `GeneradorEtiquetasWord.js`
4. Se guarda en `Directory.Cache` con Capacitor
5. Se comparte con **Share API** nativa de Capacitor
6. **Notificaci√≥n** de √©xito o error

#### **CompartirExcel.js** (reutilizado)
- Mismo m√≥dulo usado en Pedidos
- **Share API nativa** de Capacitor
- Compatible con Word (.docx)

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **PaginaEtiquetas.vue**
configuracionBarra: {
  mostrarAtras: true,
  mostrarInicio: true,
  mostrarAgregar: false,
  mostrarEnviar: etiquetas.length > 0,
  puedeEnviar: etiquetas.length > 0,
  botonesPersonalizados: []
}

---

### ‚úÖ **Flujo de Trabajo T√≠pico**

1. **Seleccionar tama√±o** (opcional, default: Grande):
   - Chico: Para etiquetas peque√±as
   - Mediano: Tama√±o est√°ndar
   - Grande: M√°xima legibilidad

2. **Agregar etiquetas manualmente**:
   - Escribir c√≥digo ‚Üí Se activa buscador
   - Seleccionar art√≠culo ‚Üí Autocompleta todo
   - Ajustar cantidad de copias (si necesita m√°s de 1)
   - Click en agregar

3. **Agregar etiquetas con c√°mara**:
   - Click en bot√≥n c√°mara
   - Escanear c√≥digo
   - Sistema busca en base de datos
   - Autocompleta descripci√≥n y ubicaci√≥n
   - Ajustar cantidad
   - Agregar

4. **Editar etiquetas**:
   - Click en icono l√°piz
   - Modificar campos necesarios
   - Guardar

5. **Ajustar cantidades**:
   - Usar botones +/- directamente en la tabla
   - O editar n√∫mero manualmente

6. **Generar documento Word**:
   - Click en bot√≥n "Enviar"
   - Esperar generaci√≥n
   - Compartir con app deseada (WhatsApp, Gmail, Drive, etc.)

---

### üìä **Estructura de Datos**

#### **Etiqueta Individual**
{
  id: timestamp,                    // ID √∫nico
  codigo: "ABC123",                 // c√≥digo del art√≠culo
  descripcion: "Nombre producto",   // descripci√≥n/nombre
  ubicacion: "A-1-2",              // ubicaci√≥n f√≠sica
  cantidad: 3,                      // cantidad de copias
  tamano: "grande"                  // tama√±o seleccionado
}

#### **Array de Etiquetas (en memoria)**
[
  { id: 1704067200000, codigo: "ABC123", descripcion: "Producto 1", ubicacion: "A-1-2", cantidad: 2, tamano: "grande" },
  { id: 1704067201000, codigo: "XYZ789", descripcion: "Producto 2", ubicacion: "B-3-1", cantidad: 1, tamano: "grande" }
]

**Nota**: Las etiquetas se mantienen **solo en memoria** mientras se trabaja. No se persisten en `@capacitor/preferences`.

---

### üìä **Detecci√≥n de Problemas**

#### **C√≥digos Duplicados**
- **Detecci√≥n autom√°tica** en TablaEtiquetas
- **Resaltado visual** con fondo naranja
- **Contador** en header de tabla
- **Permite duplicados**: Es v√°lido generar m√∫ltiples etiquetas del mismo art√≠culo

#### **Art√≠culos Inexistentes**
- **Verificaci√≥n** contra base de datos Excel
- **Resaltado visual** con fondo rojo
- **Contador** en header de tabla
- **Permite agregar**: √ötil para art√≠culos nuevos no catalogados

---

### üé® **Caracter√≠sticas de UI/UX**

- **Selector de tama√±o** con radio buttons visuales
- **Formulario responsive** con grid adaptativo
- **Tabla responsive** con dise√±o de cards en m√≥vil
- **Controles de cantidad inline** con botones +/-
- **Validaciones con animaciones** de sacudida
- **Feedback visual** para c√≥digos duplicados y art√≠culos inexistentes
- **Loading spinner** durante generaci√≥n de documento
- **Notificaciones** de √©xito/error
- **Confirmaciones** antes de acciones destructivas
- **Iconos consistentes** con @tabler/icons-vue

---

### üíæ **Sistema de Persistencia de Etiquetas**

**Las etiquetas se guardan autom√°ticamente usando `@capacitor/preferences`**

#### **usoAlmacenamientoEtiquetas.js**
- **Ubicaci√≥n**: `src/components/BaseDeDatos/usoAlmacenamientoEtiquetas.js`
- **Clave de almacenamiento**: `historial_etiquetas`

**Funciones exportadas**:
```javascript
guardarEtiquetas(etiquetas)      // Guarda array de etiquetas
obtenerEtiquetas()               // Retorna array de etiquetas guardadas
eliminarEtiquetas()              // Borra todas las etiquetas del storage

[
  {
    id: 1704067200000,
    codigo: "ABC123",
    descripcion: "Producto 1",
    ubicacion: "A-1-2",
    cantidad: 2,
    tamano: "grande"
  },
  // ... m√°s etiquetas
]

---

### üîß **Dependencias Espec√≠ficas**

- **docx**: Generaci√≥n de documentos Word
- **jsbarcode**: Generaci√≥n de c√≥digos de barras Code 39
- **@capacitor/filesystem**: Guardado de archivos temporales
- **@capacitor/share**: Compartir archivos generados
- **@zxing/library**: Escaneo de c√≥digos (en CamaraEscaneo)
- **@tabler/icons-vue**: Iconograf√≠a

---

### üìù **Notas Importantes**

- Las etiquetas **no se persisten** - solo existen mientras se trabaja en la p√°gina
- El **tama√±o de fuente** de la descripci√≥n se ajusta autom√°ticamente seg√∫n longitud
- Los **c√≥digos de barras** son formato Code 39 (est√°ndar industrial)
- El **documento Word** tiene formato personalizado 10x15cm
- Cada etiqueta ocupa **una p√°gina completa** del documento
- Las **copias** se generan como p√°ginas duplicadas consecutivas
- Los **art√≠culos inexistentes** se pueden agregar (√∫til para nuevos productos)
- El **sistema de ubicaciones** es opcional - puede dejarse "Sin ubicaci√≥n"
- El **buscador inteligente** facilita encontrar art√≠culos r√°pidamente
- La **base de datos Excel** debe estar cargada para autocompletado √≥ptimo
