### **M√≥dulo de Ubicaciones - Bit√°cora II**

Sistema completo para gestionar ubicaciones de art√≠culos con base de datos Excel, b√∫squeda inteligente y exportaci√≥n optimizada.

---

### üì¶ **Componentes Principales**

#### **AjustarUbicaciones.vue**
- **P√°gina principal** del m√≥dulo de ubicaciones
- **Ruta**: `/AjustarUbicaciones`
- **Integraci√≥n completa** con todos los componentes del m√≥dulo
- **Selector de base de datos Excel** en la parte superior
- **Formulario de ubicaciones** responsive
- **Tabla de ubicaciones** con acciones
- **Env√≠o a etiquetas**: Integraci√≥n directa con m√≥dulo de etiquetas
- **Responsive design** adaptativo

#### **FormularioUbicacion.vue**
- **Formulario responsive** para alta/edici√≥n de ubicaciones
- **Campos**:
  - **C√≥digo del art√≠culo** con buscador inteligente integrado
  - **Ubicaci√≥n** con formateo autom√°tico
- **Scroll autom√°tico** al enfocar inputs
- **Formateo autom√°tico** de ubicaciones (espacios ‚Üí guiones)
- **Integraci√≥n con CodigoMasNombre.vue** para autocompletado
- **Recordar √∫ltima ubicaci√≥n** - Carga autom√°ticamente la √∫ltima ubicaci√≥n usada
- **Bot√≥n IconTrash** para limpiar ubicaci√≥n recordada cuando se cambia de zona
- **Mantener ubicaci√≥n** entre art√≠culos consecutivos (solo limpia el c√≥digo)
- **Validaciones** con feedback visual
- **Botones**: agregar manual o abrir c√°mara

#### **TablaUbicaciones.vue**
- **Lista completa** de ubicaciones guardadas
- **Muestra nombres de art√≠culos** obtenidos de la base de datos Excel
- **Detecci√≥n visual de c√≥digos duplicados** (fondo naranja)
- **Contador de c√≥digos duplicados** en header
- **Columnas**: Nombre y C√≥digo, Ubicaci√≥n, Acciones
- **Acciones**: 
  - **Enviar a etiquetas** (bot√≥n verde IconTag)
  - **Editar** ubicaci√≥n
  - **Eliminar** ubicaci√≥n individual
- **Bot√≥n limpiar todo** con confirmaci√≥n
- **Responsive** con dise√±o de cards en m√≥vil
- **Sin ubicaciones antiguas** en UI (solo en Excel exportado)

#### **CamaraEscaneo.vue**
- **Modal con c√°mara** para escaneo de c√≥digos
- **@zxing/library** para escaneo en tiempo real
- **Escaneo de c√≥digos de barra y QR**
- **Lista de c√≥digos escaneados** con opci√≥n de eliminar
- **Botones**: finalizar (confirma todos), cancelar
- **Manejo de permisos** de c√°mara
- **Usado en**: FormularioUbicacion y FormularioEtiqueta

#### **CamaraUbicaciones.vue**
- **Modal espec√≠fico** para escaneo r√°pido de ubicaciones
- **Recordar ubicaci√≥n** durante escaneos m√∫ltiples
- **Mantener ubicaci√≥n** entre art√≠culos (workflow optimizado)
- **Campo de ubicaci√≥n** editable durante el escaneo
- **Escaneo continuo** sin cerrar modal
- **Botones**: finalizar, cancelar

#### **ModalEditarUbicacion.vue**
- **Modal para editar** ubicaciones existentes
- **Campos editables**: c√≥digo y ubicaci√≥n
- **Validaciones** completas con feedback visual
- **Botones**: guardar y cancelar
- **Integraci√≥n** con sistema de persistencia

---

### üîó **Integraci√≥n con Etiquetas**

#### **Bot√≥n "Enviar a Etiquetas"**
- **Icono**: IconTag (verde)
- **Posici√≥n**: Primera acci√≥n en cada fila
- **Funci√≥n**: Env√≠a c√≥digo, descripci√≥n y ubicaci√≥n al m√≥dulo de etiquetas
- **Datos enviados**:
  - `codigo`: C√≥digo del art√≠culo
  - `descripcion`: Nombre obtenido de base de datos
  - `ubicacion`: Ubicaci√≥n actual (no la antigua)
  - `cantidad`: 1 (por defecto)
  - `tamano`: 10x15cm (por defecto)
- **Sin cambio de p√°gina**: Usuario permanece en ubicaciones
- **Notificaci√≥n**: Mensaje de confirmaci√≥n al agregar
- **Persistencia**: Se guarda autom√°ticamente en almacenamiento de etiquetas

---

### üìä **Sistema de Base de Datos Excel**

#### **SelectorExcel.vue**
- **Componente completo** para seleccionar y cargar archivos Excel
- **Estados visuales**:
  - **No cargado**: Bot√≥n para seleccionar archivo
  - **Cargando**: Barra de progreso animada
  - **Cargado**: Tarjeta con informaci√≥n del archivo
  - **Error**: Mensaje de error espec√≠fico
- **Selector nativo** de archivos con validaci√≥n (.xlsx, .xls)
- **Informaci√≥n del archivo**: nombre, tama√±o, cantidad de art√≠culos
- **Acciones**: cambiar archivo, limpiar base de datos
- **Modal de confirmaci√≥n** para limpiar base
- **Preview de datos** (modo desarrollo)
- **Carga autom√°tica** al montar el componente

#### **LectorExcel.js**
- **M√≥dulo central** para procesar archivos Excel
- **Selector manual** usando `input[type="file"]`
- **Procesamiento con XLSX**: lectura como ArrayBuffer
- **Validaciones**: formato de archivo, estructura de datos
- **Estado global**: art√≠culos cargados, estado de carga, informaci√≥n del archivo

**Funciones exportadas**:
- `cargarArticulosDesdeExcel()`
- `obtenerArticulosCargados()`
- `obtenerArticuloPorCodigo(codigo)` - **Nueva funci√≥n**
- `obtenerEstadoCarga()`
- `obtenerInformacionArchivo()`
- `obtenerUbicacionAntigua(codigo)`
- `obtenerStock(codigo)`
- `reiniciarBaseDatos()`
- `verificarSoporteSelector()`
- `inicializarBaseDatos()`

**Persistencia autom√°tica**:
- Los art√≠culos se **guardan autom√°ticamente** en `@capacitor/preferences` despu√©s de cargar
- Se **restauran autom√°ticamente** al inicializar el m√≥dulo
- **Limpieza autom√°tica** si hay errores o datos corruptos
- **Sin intervenci√≥n del usuario** - Una vez cargado, siempre disponible
- **Inicializaci√≥n autom√°tica** al importar el m√≥dulo con `setTimeout`

**Estructura de art√≠culo**: `{ codigo, nombre, ubicacionAntigua, stock }`

---

### üîé **Sistema de B√∫squeda Inteligente**

#### **CodigoMasNombre.vue**
- **Buscador integrado** con base de datos Excel cargada
- **Monitoreo autom√°tico** de cambios en la base (polling cada 1s)
- **M√≠nimo 3 caracteres** para activar b√∫squeda

**B√∫squeda priorizada** (en este orden):
1. **C√≥digos exactos**: Empiezan exactamente con la b√∫squeda
2. **Nombres completos**: Contienen todas las palabras buscadas
3. **C√≥digos parciales**: Contienen la b√∫squeda
4. **Nombres parciales**: Coincidencias parciales

**Interfaz visual**:
- **T√≠tulo din√°mico** seg√∫n estado de base de datos
- **Resaltado de texto** en coincidencias
- **Estados**: "Art√≠culos encontrados", "Art√≠culo inexistente", "Base de datos no cargada"
- **M√°ximo 3 resultados** por b√∫squeda
- **Detecci√≥n autom√°tica** de base cargada/descargada
- **Compatible con persistencia autom√°tica**

**Emisi√≥n de eventos**: `@articulo-seleccionado` retorna `{ codigo, nombre }`

---

### üíæ **Sistema de Recordar Ubicaciones**

#### **recordarUltimaTipografia.js**
- **M√≥dulo dedicado** para gestionar la √∫ltima ubicaci√≥n usada
- **Persistencia entre sesiones** usando `@capacitor/preferences`
- **Formateo autom√°tico**: Convierte a may√∫sculas y limpia espacios

**Funciones principales**:
- `guardarUltimaUbicacion(ubicacion)`
- `obtenerUltimaUbicacion()`
- `limpiarUltimaUbicacion()`

**Workflow optimizado**:
1. **Carga autom√°tica**: Al abrir formulario/c√°mara se carga la √∫ltima ubicaci√≥n
2. **Solo limpia c√≥digo**: Despu√©s de agregar un art√≠culo, mantiene la ubicaci√≥n
3. **Bot√≥n IconTrash**: Para cambiar de zona r√°pidamente
4. **Ideal para inventarios**: M√∫ltiples art√≠culos en la misma ubicaci√≥n f√≠sica

---

### üìÅ **L√≥gica de Exportaci√≥n**

#### **ExportarUbicacionesExcel.js**
- **Generaci√≥n de Excel** con ubicaciones
- **Nombre de archivo**: `Ubic Usuario.xlsx`
- **Nombre de hoja**: Nombre del usuario
- **Anchos optimizados** para todas las columnas seg√∫n contenido real

**Columnas del Excel**:
- **A - C√≥digo**: C√≥digo del art√≠culo (ancho optimizado)
- **B - Descripci√≥n**: Nombre del art√≠culo de la base de datos (ancho optimizado)
- **C - Ubicaci√≥n**: Ubicaci√≥n actual (ancho optimizado)
- **D - Ubicaci√≥n Antigua**: De la base de datos Excel (ancho optimizado)
- **E - Observaciones**: Para notas manuales (ancho fijo)
- **F - Fecha**: Fecha de √∫ltima modificaci√≥n (ancho fijo)
- **G - Usuario**: Nombre del usuario (ancho fijo)
- **H - Info**: **Sistema de emojis** para identificaci√≥n r√°pida

**Sistema de emojis en columna Info**:
- **‚ùå**: Ubicaci√≥n es "SL" o art√≠culo no existe en base de datos
- **‚úîÔ∏è**: Ubicaci√≥n correcta y art√≠culo existe

**Caracter√≠sticas**:
- **Integraci√≥n con base de datos**: Obtiene nombres autom√°ticamente
- **Formato limpio**: Sin problemas de compatibilidad de colores
- **100% compatible** con todas las versiones de Excel
- **Ordenamiento**: Por c√≥digo ascendente
- **Fecha actual**: Se agrega autom√°ticamente

---

### üíæ **Almacenamiento y Persistencia**

#### **usoAlmacenamientoUbicaciones.js**
- **M√≥dulo especializado** para ubicaciones
- **Funciones principales**:
  - `guardarUbicaciones(ubicaciones)`
  - `obtenerUbicaciones()`
  - `agregarUbicacion(codigo, ubicacion)`
  - `eliminarUbicacion(id)`
  - `editarUbicacion(id, codigo, ubicacion)`
  - `limpiarUbicaciones()`

**Estructura de ubicaci√≥n**: `{ id, codigo, ubicacion, fecha }`

- **Persistencia** en `@capacitor/preferences`
- **Key**: `"ubicaciones"`

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **AjustarUbicaciones.vue**
- `mostrarAtras: true`
- `mostrarInicio: true`
- `mostrarAgregar: false`
- `mostrarEnviar: ubicaciones.length > 0`

---

### üìä **Detecci√≥n de Problemas**

#### **C√≥digos Duplicados**
- **Detecci√≥n autom√°tica** en TablaUbicaciones
- **Resaltado visual** con fondo naranja
- **Contador** en header de tabla
- **Normalizaci√≥n**: Compara en may√∫sculas sin espacios

#### **Art√≠culos Inexistentes**
- **Verificaci√≥n** contra base de datos Excel
- **Identificaci√≥n** en Excel exportado con ‚ùå
- **Permite agregar** art√≠culos no catalogados

#### **Ubicaciones SL (Sin Ubicaci√≥n)**
- **Detecci√≥n** de ubicaci√≥n vac√≠a o "SL"
- **Marca** con ‚ùå en Excel exportado
- **Permite identificar** art√≠culos pendientes de ubicar

---

### üé® **Caracter√≠sticas de UI/UX**

- **Tabla responsive** con dise√±o de cards en m√≥vil
- **Scroll autom√°tico** al enfocar inputs
- **Formateo en tiempo real** de ubicaciones
- **Buscador dropdown** con resultados resaltados
- **Iconos consistentes** con @tabler/icons-vue
- **Estados de carga** con spinners
- **Notificaciones** de √©xito/error
- **Confirmaciones** antes de acciones destructivas
- **Bot√≥n IconTrash** para limpiar ubicaci√≥n recordada
- **Visual feedback** para c√≥digos duplicados
- **Bot√≥n verde IconTag** para enviar a etiquetas

---

### üîß **Dependencias Espec√≠ficas**

- **xlsx**: Procesamiento y generaci√≥n de Excel
- **@capacitor/filesystem**: Guardado de archivos
- **@capacitor/share**: Compartir archivos
- **@capacitor/preferences**: Persistencia de datos
- **@zxing/library**: Escaneo de c√≥digos
- **@tabler/icons-vue**: Iconograf√≠a

---

### üìù **Notas Importantes**

- La **base de datos Excel** se carga una sola vez y persiste autom√°ticamente
- El sistema de **recordar ubicaci√≥n** es ideal para inventarios f√≠sicos
- Las **ubicaciones antiguas** solo aparecen en Excel exportado, no en UI
- El **buscador inteligente** prioriza coincidencias exactas
- Los **c√≥digos duplicados** se detectan autom√°ticamente
- El **sistema de emojis** en Excel facilita identificaci√≥n r√°pida de problemas
- El **formateo autom√°tico** convierte espacios en guiones (A 1 2 ‚Üí A-1-2)
- El **bot√≥n de etiquetas** permite workflow r√°pido: ubicar y etiquetar sin cambiar de p√°gina
- Las **etiquetas enviadas** usan la ubicaci√≥n actual, no la de la base de datos
