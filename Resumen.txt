### **Estado Actual del Proyecto: Bit√°cora II**

Estoy desarrollando una aplicaci√≥n en **Vue 3 con Quasar** llamada **Bit√°cora II**, orientada a la gesti√≥n de **pedidos internos, ubicaciones e inventario**. Es un sistema de trabajo pensado para correr como aplicaci√≥n m√≥vil en Android, con la meta de generar un archivo **.APK** e instalarlo en un dispositivo f√≠sico, para luego publicarlo en la **Play Store de Google**.  

---

### üì¶ **Estructura Actual**

#### üß© **Componentes Principales**
- **PedidosRealizados.vue:** Muestra todos los pedidos guardados y ofrece un bot√≥n para **enviar** el Excel.  
- **HistorialPedidos.vue:** Historial de pedidos agrupados por fechas, tambi√©n con bot√≥n de **Enviar**.  
- **Inicio.vue (PanelInicio.vue):** Pantalla principal de navegaci√≥n hacia las distintas funciones.  
- **ModalNuevoPedido.vue:** Modal para agregar pedidos manuales, con input, bot√≥n de c√°mara y confirmaci√≥n.  
  - Input manual: agrega un solo pedido y cierra el modal autom√°ticamente.  
  - Bot√≥n de c√°mara: abre **CamaraPedidos.vue** para escanear m√∫ltiples pedidos.  
- **CamaraPedidos.vue:** Modal con c√°mara embebida en un `<div>` + botones personalizados. Usa **@zxing/library** para escaneo en tiempo real de c√≥digos de barra y QR.  
- **AjustarUbicaciones.vue:** Tabla para gestionar ubicaciones de art√≠culos, con formulario responsive, edici√≥n y eliminaci√≥n.  
  - Agregar ubicaciones manualmente o usando la c√°mara.  
  - **‚úÖ INTEGRACI√ìN CON BARRA INFERIOR NUEVA**: Configuraci√≥n din√°mica de botones seg√∫n el estado.
  - **Integra SelectorExcel** para cargar base de datos de art√≠culos.
  - **Sistema de notificaciones** mejorado con mensajes de √©xito/error.
- **ModalEliminar.vue:** Modal gen√©rico, reutilizable tanto en pedidos como en ubicaciones.  
- **CodigoMasNombre.vue:** Componente que implementa la l√≥gica de b√∫squeda en base de datos, mostrando coincidencias din√°micamente con **base de datos cargada desde Excel**.  

---

#### üìÅ **L√≥gica de Exportaci√≥n y Guardado de Archivos**

#### ‚úÖ **Componentes NUEVOS:**
- **BarraBotonesInferior.vue:** **COMPONENTE PRINCIPAL DE NAVEGACI√ìN**
  - **Barra flotante centrada** con dise√±o moderno y redondeado.
  - **Botones din√°micos**: atr√°s, inicio, agregar, enviar.
  - **Configuraci√≥n por props**: cada p√°gina define qu√© botones mostrar.
  - **Botones personalizados**: sistema extensible para acciones espec√≠ficas.
  - **Estados din√°micos**: habilitar/deshabilitar seg√∫n contexto.
  - **Responsive design** con ajustes para pantallas peque√±as.
  - **Auto-ocultamiento**: bot√≥n "atr√°s" se oculta autom√°ticamente en p√°gina inicial.
  - **Efectos visuales**: hover, active, sombras, transiciones suaves.

#### ‚úÖ **Componentes MANTENIDOS:**
- **TresBotones.vue:** Para formularios y modales (confirmar, cancelar, eliminar).

#### üîÑ **Sistema de Configuraci√≥n Din√°mica:**
- **Configuraci√≥n por p√°gina**: Cada p√°gina emite su configuraci√≥n de botones.
- **Watchers reactivos**: Los botones se actualizan autom√°ticamente seg√∫n el estado.
- **M√©todos de callback**: Las p√°ginas definen qu√© hacer cuando se presiona cada bot√≥n.
- **Cleanup autom√°tico**: Se limpia la configuraci√≥n al salir de las p√°ginas.

---

### üìÅ **L√≥gica de Exportaci√≥n y Guardado de Archivos**
- Uso de **xlsx** para generar datos Excel en memoria.  
- Descarga directa en la web (`exportarExcel.js`).  
- M√≥dulo reutilizable (`GeneraExcel.js`) con funci√≥n `generarYGuardarExcelTemporal`.  
- Uso de **@capacitor/filesystem** para guardar Excel en Base64 en `Directory.Cache`.  
- Nombre de archivo din√°mico con rango de fechas (`Pedidos_DD-MM-AAAA_a_DD-MM-AAAA.xlsx`).  
- **ExportarUbicacionesExcel.js** para manejar exportaci√≥n y env√≠o de Excel desde el m√≥dulo de ubicaciones.  
  - **Integraci√≥n con base de datos cargada**: Obtiene nombres de art√≠culos autom√°ticamente usando `obtenerNombreArticulo()`.
  - Genera columnas: `articulo`, `sub1`, `sub2`, `deposito`, `ubic`, `Descripcion`.
- **‚úÖ INTEGRADO CON BARRA INFERIOR**: Bot√≥n de env√≠o disponible din√°micamente.

---

#### üíæ **Almacenamiento de Datos**
- Persistencia con **@capacitor/preferences**.  
- Manejo centralizado en `almacenamiento.js`.  
- `usoAlmacenamientoPedidos.js` y `usoAlmacenamientoUbicaciones.js` para modularizar la l√≥gica.  
- Rutas corregidas para evitar errores de imports din√°micos (404).
- **recordarUltimaTipografia.js**: M√≥dulo para persistir la √∫ltima ubicaci√≥n ingresada entre sesiones.
- **‚úÖ NUEVA: Persistencia autom√°tica de base de datos Excel** - Los art√≠culos se guardan autom√°ticamente en `@capacitor/preferences` y se cargan al inicializar sin intervenci√≥n del usuario.

---

#### üì∑ **Integraci√≥n de C√°mara y Escaneo**
- Implementaci√≥n con **@zxing/library** dentro de un `<div>` con botones personalizados.  
- **CamaraPedidos.vue** maneja permisos de c√°mara, escaneo en tiempo real y muestra miniatura de la √∫ltima captura.  
- **CamaraEscaneo.vue** y **CamaraUbicaciones.vue** para escaneo espec√≠fico de ubicaciones.
- Optimizaci√≥n del escaneo para c√≥digos de barra y QR ‚úÖ.
- **Funcionalidad mejorada**: Recordar √∫ltima ubicaci√≥n durante escaneos consecutivos.

---

#### üóÇÔ∏è **M√≥dulo de Ubicaciones**
- **FormularioUbicacion.vue:** Alta/edici√≥n responsive con **integraci√≥n del buscador inteligente**.
  - Scroll autom√°tico al enfocar inputs.
  - Formateo autom√°tico de ubicaciones (espacios ‚Üí guiones).
  - Integraci√≥n con **CodigoMasNombre.vue** para autocompletado.
  - **‚úÖ NUEVO: Recordar √∫ltima ubicaci√≥n** - Carga autom√°ticamente la √∫ltima ubicaci√≥n usada.
  - **‚úÖ NUEVO: Bot√≥n IconTrash** para limpiar ubicaci√≥n recordada cuando se cambia de zona.
  - **‚úÖ NUEVO: Mantener ubicaci√≥n** entre art√≠culos consecutivos (solo limpia el c√≥digo).
- **TablaUbicaciones.vue:** Lista de ubicaciones con acciones y **detecci√≥n de c√≥digos duplicados**.
  - Muestra nombres de art√≠culos obtenidos de la base de datos.
  - Resalta visualmente c√≥digos repetidos.
  - Contador de c√≥digos duplicados.
- **ModalEditarUbicacion.vue:** Edici√≥n puntual.  
- **ModalEliminar.vue:** Confirmaci√≥n reutilizada.  
- **ExportarUbicacionesExcel.js:** Exportaci√≥n de ubicaciones a Excel con nombres autom√°ticos.  
- **CamaraUbicaciones.vue:** Escaneo r√°pido de ubicaciones.
  - **‚úÖ NUEVO: Recordar ubicaci√≥n** durante escaneos m√∫ltiples.
  - **‚úÖ NUEVO: Mantener ubicaci√≥n** entre art√≠culos (workflow optimizado).

---

### üìä **Sistema de Base de Datos Excel**
- **SelectorExcel.vue:** Componente completo para seleccionar y cargar archivos Excel.
  - Interfaz visual con estados: no-cargado, cargando, cargado, error.
  - **Selector nativo de archivos** con validaci√≥n de formato (.xlsx, .xls).
  - **Informaci√≥n del archivo**: nombre, tama√±o, cantidad de art√≠culos.
  - **Acciones**: cambiar archivo, limpiar base de datos.
  - **Estados visuales**: iconos, barras de progreso, mensajes de error.
  - **Preview de datos** (modo desarrollo).
  - **Modal de confirmaci√≥n** para limpiar base de datos.
  - **‚úÖ NUEVA: Carga autom√°tica** - Al montar el componente inicializa autom√°ticamente la base de datos desde persistencia.

- **LectorExcel.js:** L√≥gica central para procesar archivos Excel.
  - **Selector manual de archivos** usando `input[type="file"]`.
  - **Procesamiento con XLSX**: lectura como ArrayBuffer.
  - **Validaciones**: formato de archivo, estructura de datos.
  - **Estado global**: art√≠culos cargados, estado de carga, informaci√≥n del archivo.
  - **‚úÖ NUEVA: Persistencia autom√°tica**:
    - Los art√≠culos se guardan autom√°ticamente en `@capacitor/preferences` despu√©s de cargar.
    - Se restauran autom√°ticamente al inicializar el m√≥dulo (funci√≥n `inicializarBaseDatos()`).
    - Limpieza autom√°tica si hay errores o datos corruptos.
    - **Sin intervenci√≥n del usuario** - Una vez cargado, siempre disponible.
  - **Funciones exportadas**:
    - `cargarArticulosDesdeExcel()`: funci√≥n principal.
    - `obtenerArticulosCargados()`: obtiene art√≠culos cargados.
    - `obtenerEstadoCarga()`: estado actual de la base.
    - `obtenerInformacionArchivo()`: info del archivo.
    - `reiniciarBaseDatos()`: limpia todo (ahora async).
    - `verificarSoporteSelector()`: valida soporte del navegador.
    - **‚úÖ NUEVA: `inicializarBaseDatos()`**: carga autom√°tica desde persistencia.
  - **‚úÖ NUEVA: Inicializaci√≥n autom√°tica**: Se ejecuta autom√°ticamente al importar el m√≥dulo con `setTimeout`.

---

#### üîé **Sistema de B√∫squeda Inteligente**
- **CodigoMasNombre.vue:** Buscador con base de datos Excel cargada.
  - **Monitoreo autom√°tico** de cambios en la base de datos (polling cada 1s).
  - **B√∫squeda priorizada**:
    1. C√≥digos que empiecen exactamente con la b√∫squeda.
    2. Nombres que contengan todas las palabras.
    3. C√≥digos que contengan la b√∫squeda.
    4. Nombres con coincidencias parciales.
  - **Interfaz visual**:
    - T√≠tulo din√°mico seg√∫n estado de base de datos.
    - **Resaltado de texto** en coincidencias.
    - Estados: "Art√≠culos encontrados", "Art√≠culo inexistente", "Base de datos no cargada".
  - **M√°ximo 3 resultados** por b√∫squeda.
  - **M√≠nimo 3 caracteres** para activar b√∫squeda.
  - **Detecci√≥n autom√°tica** de base de datos cargada/descargada.
  - **‚úÖ MEJORADO: Compatible con persistencia autom√°tica** - Detecta autom√°ticamente cuando la base se carga desde persistencia.

---

#### üíæ **Sistema de Recordar Ubicaciones**
- **recordarUltimaTipografia.js:** M√≥dulo dedicado para gestionar la √∫ltima ubicaci√≥n.
  - **Funciones principales**:
    - `guardarUltimaUbicacion()`: Persiste la ubicaci√≥n en Capacitor Preferences.
    - `obtenerUltimaUbicacion()`: Recupera la ubicaci√≥n guardada.
    - `limpiarUltimaUbicacion()`: Elimina la ubicaci√≥n recordada.
  - **Persistencia entre sesiones** usando `@capacitor/preferences`.
  - **Formateo autom√°tico**: Convierte a may√∫sculas y limpia espacios.
  
- **Workflow optimizado para ubicaciones**:
  - **Carga autom√°tica**: Al abrir formulario/c√°mara se carga la √∫ltima ubicaci√≥n.
  - **Solo limpia c√≥digo**: Despu√©s de agregar un art√≠culo, mantiene la ubicaci√≥n.
  - **Bot√≥n de limpieza**: IconTrash para cambiar de zona r√°pidamente.
  - **Ideal para inventarios**: M√∫ltiples art√≠culos en la misma ubicaci√≥n f√≠sica.

---

#### üé® **Integraci√≥n Visual y UX**
- **‚úÖ NUEVA: Barra de navegaci√≥n inferior moderna**:
  - Dise√±o flotante centrado con bordes redondeados.
  - Sombras y efectos visuales profesionales.
  - Botones circulares con hover effects.
  - Sistema de iconos consistente con Tabler Icons.
  - Responsive con ajustes autom√°ticos para pantallas peque√±as.

- **Estados visuales claros** en SelectorExcel:
  - Bot√≥n principal cambia color seg√∫n estado.
  - Iconos espec√≠ficos: carpeta, cargando, error, base de datos.
  - **Tarjeta de archivo** con estad√≠sticas y acciones.

- **‚úÖ NUEVO: Sistema de notificaciones mejorado**:
  - Mensajes de √©xito y error con timeouts autom√°ticos.
  - Feedback visual para todas las acciones importantes.
  - Integraci√≥n con el sistema de barra inferior.

- **Feedback al usuario**:
  - Barras de progreso durante carga.
  - Mensajes de error espec√≠ficos y claros.
  - Confirmaci√≥n antes de limpiar datos.
  - **‚úÖ NUEVO: Sin interrupciones** - La base se carga autom√°ticamente en segundo plano.

- **Responsive design** en todos los componentes.
- **‚úÖ NUEVO: Botones de limpiar ubicaci√≥n**:
  - IconTrash consistente con el resto de la aplicaci√≥n.
  - Efectos hover con transiciones suaves.
  - Posicionamiento absoluto dentro del input.
  - CSS unificado en archivo principal.

---

### ‚úÖ **Resumen de Logros Actuales**
- Persistencia de pedidos y ubicaciones.  
- Generaci√≥n y guardado de Excel con Capacitor.  
- Env√≠o de Excel por apps nativas.  
- Escaneo de c√≥digos en tiempo real funcionando.  
- Interfaz modular (UI, datos, c√°mara, exportaci√≥n).  
- Reutilizaci√≥n de componentes (botones, modales, c√°mara).  
- Feedback al usuario con notificaciones.  
- Gesti√≥n completa de ubicaciones.  
- **‚úÖ Sistema completo de carga y gesti√≥n de base de datos Excel**.
- **‚úÖ B√∫squeda inteligente de art√≠culos con coincidencias din√°micas y base de datos**.
- **‚úÖ Exportaci√≥n mejorada con nombres autom√°ticos de art√≠culos**.
- **‚úÖ Detecci√≥n y visualizaci√≥n de c√≥digos duplicados**.
- **‚úÖ UX mejorada con scroll autom√°tico y formateo**.
- **‚úÖ Sistema de recordar √∫ltima ubicaci√≥n para workflow optimizado**.
- **‚úÖ Persistencia de ubicaciones entre sesiones de la app**.
- **‚úÖ Botones de limpieza con iconograf√≠a consistente y efectos visuales**.
- **‚úÖ NUEVA: Persistencia autom√°tica de base de datos Excel** - Se guarda y restaura autom√°ticamente sin intervenci√≥n del usuario.
- **‚úÖ NUEVA: Inicializaci√≥n autom√°tica** - La base de datos se carga autom√°ticamente al iniciar la aplicaci√≥n.
- **‚úÖ NUEVA: UX sin fricciones** - El usuario carga el archivo una vez y queda disponible para siempre.
- **üöÄ NUEVO: Sistema de navegaci√≥n centralizado y moderno**:
  - Barra inferior flotante con configuraci√≥n din√°mica por p√°gina.
  - Arquitectura escalable para botones personalizados.
  - Limpieza de componentes obsoletos para mejor mantenimiento.
  - UX consistente en toda la aplicaci√≥n.

---

### üéØ **Siguientes Objetivos**
- Refinar experiencia en env√≠os (manejo de errores).  
- Mejorar UI/UX general.  
- Implementar control de stock con exportaci√≥n a Excel.  
- Ajustar detalles de c√°mara y modales.  
- **Optimizar rendimiento** del buscador para bases de datos grandes.
- **Implementar cach√©** para b√∫squedas frecuentes.
- **Mejorar validaciones** de archivos Excel (estructura de columnas).
- **Agregar estad√≠sticas** de ubicaciones m√°s utilizadas.

---

### üìÇ **Estructura de Archivos**
src
‚îú‚îÄ‚îÄ App.vue
‚îú‚îÄ‚îÄ css
‚îÇ   ‚îî‚îÄ‚îÄ app.css
‚îú‚îÄ‚îÄ layouts
‚îÇ   ‚îî‚îÄ‚îÄ MainLayout.vue
‚îú‚îÄ‚îÄ pages
‚îÇ   ‚îú‚îÄ‚îÄ AjustarUbicaciones.vue
‚îÇ   ‚îú‚îÄ‚îÄ ErrorNotFound.vue
‚îÇ   ‚îî‚îÄ‚îÄ TablaPedidos.vue
‚îú‚îÄ‚îÄ router
‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îî‚îÄ‚îÄ routes.js
‚îú‚îÄ‚îÄ components
‚îÇ   ‚îú‚îÄ‚îÄ BaseDeDatos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CodigosArticulos.js 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ almacenamiento.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usoAlmacenamientoCapacitor.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usoAlmacenamientoPedidos.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usoAlmacenamientoUbicaciones.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LectorExcel.js
‚îÇ   ‚îú‚îÄ‚îÄ Botones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BarraBotonesInferior.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TresBotones.vue
‚îÇ   ‚îú‚îÄ‚îÄ Inicio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PanelInicio.vue
‚îÇ   ‚îú‚îÄ‚îÄ Logica
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Envios
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CompartirExcel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pedidos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CamaraPedidos.vue
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompartirExcel.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ExportarPedidosExcel.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GeneraExcel.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HistorialPedidos.vue
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PedidosRealizados.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Ubicaciones
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CamaraEscaneo.vue
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CamaraUbicaciones.vue
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CodigoMasNombre.vue
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ExportarUbicacionesExcel.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ FormularioUbicacion.vue
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TablaUbicaciones.vue
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SelectorExcel.vue
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ recordarUltimaTipografia.js
‚îÇ   ‚îú‚îÄ‚îÄ Modales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModalEditarPedido.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModalEditarUbicacion.vue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModalEliminar.vue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModalNuevoPedido.vue
```

---

### üîß **Tecnolog√≠as y Dependencias**
- **Framework**: Vue 3 + Quasar
- **Capacitor**: Filesystem, Preferences
- **XLSX**: Procesamiento de archivos Excel
- **@zxing/library**: Escaneo de c√≥digos
- **@tabler/icons-vue**: Iconograf√≠a
- **Target**: Android APK ‚Üí Google Play Store
