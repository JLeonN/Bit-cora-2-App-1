### **Estado Actual del Proyecto: BitÃ¡cora II**

Estoy desarrollando una aplicaciÃ³n en **Vue 3 con Quasar** llamada **BitÃ¡cora II**, orientada a la gestiÃ³n de **pedidos internos, ubicaciones e inventario**. Es un sistema de trabajo pensado para correr como aplicaciÃ³n mÃ³vil en Android, **ya publicada en la Play Store de Google**.

---

### ğŸ“¦ **Estructura Actual**

#### ğŸ§© **Componentes Principales**
- **PedidosRealizados.vue:** Muestra todos los pedidos guardados y ofrece un botÃ³n para **enviar** el Excel.  
- **HistorialPedidos.vue:** Historial de pedidos agrupados por fechas, tambiÃ©n con botÃ³n de **Enviar**.  
- **TablaPedidos.vue:** Pantalla principal de pedidos con tabla de Ãºltimos 3 pedidos e integraciÃ³n completa con ContadorPedidosDiarios.
- **Inicio.vue (PanelInicio.vue):** Pantalla principal de navegaciÃ³n hacia las distintas funciones.  
- **ModalNuevoPedido.vue:** Modal para agregar pedidos manuales, con input, botÃ³n de cÃ¡mara y confirmaciÃ³n.  
  - Input manual: agrega un solo pedido y cierra el modal automÃ¡ticamente.  
  - BotÃ³n de cÃ¡mara: abre **CamaraPedidos.vue** para escanear mÃºltiples pedidos.  
- **AjustarUbicaciones.vue:** Tabla para gestionar ubicaciones de artÃ­culos, con formulario responsive, ediciÃ³n y eliminaciÃ³n.  
  - Agregar ubicaciones manualmente o usando la cÃ¡mara.  
- **CamaraPedidos.vue:** Modal con cÃ¡mara embebida en un `<div>` + botones personalizados. Usa **@zxing/library** para escaneo en tiempo real de cÃ³digos de barra y QR.
- **âœ… ContadorPedidosDiarios.vue:** **COMPONENTE CON SISTEMA GAMIFICADO**
  - **Contador automÃ¡tico** de pedidos del dÃ­a actual.
  - **Reinicio a medianoche** automÃ¡tico con verificaciÃ³n cada minuto.
  - **ğŸ¯ Sistema de recompensas**: Iconos dinÃ¡micos segÃºn productividad (ğŸ‘ğŸ”¥âš¡â­ğŸ’).
  - **LÃ³gica diferenciada**: Fin de semana vs dÃ­as laborables.
  - **5 niveles de logros**: desde pulgar hasta corona segÃºn cantidad de pedidos.
  - **Persistencia** entre sesiones de la aplicaciÃ³n.
  - **IntegraciÃ³n completa** con TablaPedidos.vue - se actualiza automÃ¡ticamente.
  - **Responsive design** para dispositivos mÃ³viles.

---

#### ğŸ“ **LÃ³gica de ExportaciÃ³n y Guardado de Archivos**

#### âœ… **Componentes NUEVOS:**
- **BarraBotonesInferior.vue:** **COMPONENTE PRINCIPAL DE NAVEGACIÃ“N**
  - **Barra flotante centrada** con diseÃ±o moderno y redondeado.
  - **Botones dinÃ¡micos**: atrÃ¡s, inicio, agregar, enviar.
  - **ConfiguraciÃ³n por props**: cada pÃ¡gina define quÃ© botones mostrar.
  - **Botones personalizados**: sistema extensible para acciones especÃ­ficas.
  - **Estados dinÃ¡micos**: habilitar/deshabilitar segÃºn contexto.
  - **Responsive design** con ajustes para pantallas pequeÃ±as.
  - **Auto-ocultamiento**: botÃ³n "atrÃ¡s" se oculta automÃ¡ticamente en pÃ¡gina inicial.
  - **Efectos visuales**: hover, active, sombras, transiciones suaves.

#### âœ… **Componentes MANTENIDOS:**
- **TresBotones.vue:** Para formularios y modales (confirmar, cancelar, eliminar).

#### ğŸ”„ **Sistema de ConfiguraciÃ³n DinÃ¡mica:**
- **ConfiguraciÃ³n por pÃ¡gina**: Cada pÃ¡gina emite su configuraciÃ³n de botones.
- **Watchers reactivos**: Los botones se actualizan automÃ¡ticamente segÃºn el estado.
- **MÃ©todos de callback**: Las pÃ¡ginas definen quÃ© hacer cuando se presiona cada botÃ³n.
- **Cleanup automÃ¡tico**: Se limpia la configuraciÃ³n al salir de las pÃ¡ginas.

---

### ğŸ“ **LÃ³gica de ExportaciÃ³n y Guardado de Archivos**
- Uso de **xlsx** para generar datos Excel en memoria.  
- Descarga directa en la web (`exportarExcel.js`).  
- MÃ³dulo reutilizable (`GeneraExcel.js`) con funciÃ³n `generarYGuardarExcelTemporal`.  
- Uso de **@capacitor/filesystem** para guardar Excel en Base64 en `Directory.Cache`.  
- Nombre de archivo dinÃ¡mico con rango de fechas (`Pedidos_DD-MM-AAAA_a_DD-MM-AAAA.xlsx`).  
- **âœ… ExportarUbicacionesExcel.js MEJORADO:**
  - **Anchos optimizados** para todas las columnas segÃºn contenido real.
  - **Nueva columna H "Info"** con sistema de emojis para identificaciÃ³n rÃ¡pida.
  - **âŒ Emoji** para ubicaciones SL o artÃ­culos inexistentes.
  - **âœ”ï¸ Emoji** para ubicaciones correctas.
  - **IntegraciÃ³n con base de datos cargada**: Obtiene nombres automÃ¡ticamente.
  - **Formato limpio** sin problemas de compatibilidad de colores.

---

#### ğŸ’¾ **Almacenamiento de Datos**
- Persistencia con **@capacitor/preferences**.  
- Manejo centralizado en `almacenamiento.js`.  
- `usoAlmacenamientoPedidos.js` y `usoAlmacenamientoUbicaciones.js` para modularizar la lÃ³gica.  
- Rutas corregidas para evitar errores de imports dinÃ¡micos (404).
- **recordarUltimaTipografia.js**: MÃ³dulo para persistir la Ãºltima ubicaciÃ³n ingresada entre sesiones.
- **âœ… NUEVA: Persistencia automÃ¡tica de base de datos Excel** - Los artÃ­culos se guardan automÃ¡ticamente en `@capacitor/preferences` y se cargan al inicializar sin intervenciÃ³n del usuario.

---

#### ğŸ“· **IntegraciÃ³n de CÃ¡mara y Escaneo**
- ImplementaciÃ³n con **@zxing/library** dentro de un `<div>` con botones personalizados.  
- **CamaraPedidos.vue** maneja permisos de cÃ¡mara, escaneo en tiempo real y muestra miniatura de la Ãºltima captura.  
- **CamaraEscaneo.vue** y **CamaraUbicaciones.vue** para escaneo especÃ­fico de ubicaciones.
- OptimizaciÃ³n del escaneo para cÃ³digos de barra y QR âœ….
- **Funcionalidad mejorada**: Recordar Ãºltima ubicaciÃ³n durante escaneos consecutivos.

---

#### ğŸ—‚ï¸ **MÃ³dulo de Ubicaciones**
- **FormularioUbicacion.vue:** Alta/ediciÃ³n responsive con **integraciÃ³n del buscador inteligente**.
  - Scroll automÃ¡tico al enfocar inputs.
  - Formateo automÃ¡tico de ubicaciones (espacios â†’ guiones).
  - IntegraciÃ³n con **CodigoMasNombre.vue** para autocompletado.
  - **âœ… Recordar Ãºltima ubicaciÃ³n** - Carga automÃ¡ticamente la Ãºltima ubicaciÃ³n usada.
  - **âœ… BotÃ³n IconTrash** para limpiar ubicaciÃ³n recordada cuando se cambia de zona.
  - **âœ… Mantener ubicaciÃ³n** entre artÃ­culos consecutivos (solo limpia el cÃ³digo).
- **âœ… TablaUbicaciones.vue:** Lista de ubicaciones con acciones y **detecciÃ³n de cÃ³digos duplicados**
  - Muestra nombres de artÃ­culos obtenidos de la base de datos.
  - Resalta visualmente cÃ³digos repetidos.
  - Contador de cÃ³digos duplicados.
- **ModalEditarUbicacion.vue:** EdiciÃ³n puntual.  
- **ModalEliminar.vue:** ConfirmaciÃ³n reutilizada.  
- **CamaraUbicaciones.vue:** Escaneo rÃ¡pido de ubicaciones.
  - **âœ… Recordar ubicaciÃ³n** durante escaneos mÃºltiples.
  - **âœ… Mantener ubicaciÃ³n** entre artÃ­culos (workflow optimizado).

---

### ğŸ“Š **Sistema de Base de Datos Excel**
- **SelectorExcel.vue:** Componente completo para seleccionar y cargar archivos Excel.
  - Interfaz visual con estados: no-cargado, cargando, cargado, error.
  - **Selector nativo de archivos** con validaciÃ³n de formato (.xlsx, .xls).
  - **InformaciÃ³n del archivo**: nombre, tamaÃ±o, cantidad de artÃ­culos.
  - **Acciones**: cambiar archivo, limpiar base de datos.
  - **Estados visuales**: iconos, barras de progreso, mensajes de error.
  - **Preview de datos** (modo desarrollo).
  - **Modal de confirmaciÃ³n** para limpiar base de datos.
  - **âœ… NUEVA: Carga automÃ¡tica** - Al montar el componente inicializa automÃ¡ticamente la base de datos desde persistencia.

- **LectorExcel.js:** LÃ³gica central para procesar archivos Excel.
  - **Selector manual de archivos** usando `input[type="file"]`.
  - **Procesamiento con XLSX**: lectura como ArrayBuffer.
  - **Validaciones**: formato de archivo, estructura de datos.
  - **Estado global**: artÃ­culos cargados, estado de carga, informaciÃ³n del archivo.
  - **âœ… NUEVA: Persistencia automÃ¡tica**:
    - Los artÃ­culos se guardan automÃ¡ticamente en `@capacitor/preferences` despuÃ©s de cargar.
    - Se restauran automÃ¡ticamente al inicializar el mÃ³dulo (funciÃ³n `inicializarBaseDatos()`).
    - Limpieza automÃ¡tica si hay errores o datos corruptos.
    - **Sin intervenciÃ³n del usuario** - Una vez cargado, siempre disponible.
  - **Funciones exportadas**:
    - `cargarArticulosDesdeExcel()`: funciÃ³n principal.
    - `obtenerArticulosCargados()`: obtiene artÃ­culos cargados.
    - `obtenerEstadoCarga()`: estado actual de la base.
    - `obtenerInformacionArchivo()`: info del archivo.
    - `reiniciarBaseDatos()`: limpia todo (ahora async).
    - `verificarSoporteSelector()`: valida soporte del navegador.
    - **âœ… NUEVA: `inicializarBaseDatos()`**: carga automÃ¡tica desde persistencia.
  - **âœ… NUEVA: InicializaciÃ³n automÃ¡tica**: Se ejecuta automÃ¡ticamente al importar el mÃ³dulo con `setTimeout`.

---

#### ğŸ” **Sistema de BÃºsqueda Inteligente**
- **âœ… CodigoMasNombre.vue:** Buscador con base de datos Excel cargada
  - **Monitoreo automÃ¡tico** de cambios en la base de datos (polling cada 1s).
  - **BÃºsqueda priorizada**:
    1. CÃ³digos que empiecen exactamente con la bÃºsqueda.
    2. Nombres que contengan todas las palabras.
    3. CÃ³digos que contengan la bÃºsqueda.
    4. Nombres con coincidencias parciales.
  - **Interfaz visual**:
    - TÃ­tulo dinÃ¡mico segÃºn estado de base de datos.
    - **Resaltado de texto** en coincidencias.
    - Estados: "ArtÃ­culos encontrados", "ArtÃ­culo inexistente", "Base de datos no cargada".
  - **MÃ¡ximo 3 resultados** por bÃºsqueda.
  - **MÃ­nimo 3 caracteres** para activar bÃºsqueda.
  - **DetecciÃ³n automÃ¡tica** de base de datos cargada/descargada.
  - **âœ… MEJORADO: Compatible con persistencia automÃ¡tica** - Detecta automÃ¡ticamente cuando la base se carga desde persistencia.

---

#### ğŸ’¾ **Sistema de Recordar Ubicaciones**
- **recordarUltimaTipografia.js:** MÃ³dulo dedicado para gestionar la Ãºltima ubicaciÃ³n.
  - **Funciones principales**:
    - `guardarUltimaUbicacion()`: Persiste la ubicaciÃ³n en Capacitor Preferences.
    - `obtenerUltimaUbicacion()`: Recupera la ubicaciÃ³n guardada.
    - `limpiarUltimaUbicacion()`: Elimina la ubicaciÃ³n recordada.
  - **Persistencia entre sesiones** usando `@capacitor/preferences`.
  - **Formateo automÃ¡tico**: Convierte a mayÃºsculas y limpia espacios.
  
- **Workflow optimizado para ubicaciones**:
  - **Carga automÃ¡tica**: Al abrir formulario/cÃ¡mara se carga la Ãºltima ubicaciÃ³n.
  - **Solo limpia cÃ³digo**: DespuÃ©s de agregar un artÃ­culo, mantiene la ubicaciÃ³n.
  - **BotÃ³n de limpieza**: IconTrash para cambiar de zona rÃ¡pidamente.
  - **Ideal para inventarios**: MÃºltiples artÃ­culos en la misma ubicaciÃ³n fÃ­sica.

---

#### ğŸ¨ **IntegraciÃ³n Visual y UX**
- **âœ… Barra de navegaciÃ³n inferior moderna**:
  - DiseÃ±o flotante centrado con bordes redondeados.
  - Sombras y efectos visuales profesionales.
  - Botones circulares con hover effects.
  - Sistema de iconos consistente con Tabler Icons.
  - Responsive con ajustes automÃ¡ticos para pantallas pequeÃ±as.

- **Estados visuales claros** en SelectorExcel:
  - BotÃ³n principal cambia color segÃºn estado.
  - Iconos especÃ­ficos: carpeta, cargando, error, base de datos.
  - **Tarjeta de archivo** con estadÃ­sticas y acciones.

- **âœ… Sistema de notificaciones mejorado**:
  - Mensajes de Ã©xito y error con timeouts automÃ¡ticos.
  - Feedback visual para todas las acciones importantes.
  - IntegraciÃ³n con el sistema de barra inferior.

- **Feedback al usuario**:
  - Barras de progreso durante carga.
  - Mensajes de error especÃ­ficos y claros.
  - ConfirmaciÃ³n antes de limpiar datos.
  - **âœ… Sin interrupciones** - La base se carga automÃ¡ticamente en segundo plano.

- **âœ… UI Simplificada**:
  - **EliminaciÃ³n de informaciÃ³n redundante** en la interfaz de usuario.
  - **Ubicaciones antiguas** solo visibles en Excel exportado, no en la UI.
  - **Buscador mÃ¡s limpio** sin indicadores de tipo de coincidencia.
  - **Tablas mÃ¡s simples** enfocadas en la informaciÃ³n esencial.

- **Responsive design** en todos los componentes.
- **âœ… Botones de limpiar ubicaciÃ³n**:
  - IconTrash consistente con el resto de la aplicaciÃ³n.
  - Efectos hover con transiciones suaves.
  - Posicionamiento absoluto dentro del input.
  - CSS unificado en archivo principal.

---

### âœ… **Resumen de Logros Actuales**
- Persistencia de pedidos y ubicaciones.  
- GeneraciÃ³n y guardado de Excel con Capacitor.  
- EnvÃ­o de Excel por apps nativas.  
- Escaneo de cÃ³digos en tiempo real funcionando.  
- Interfaz modular (UI, datos, cÃ¡mara, exportaciÃ³n).  
- ReutilizaciÃ³n de componentes (botones, modales, cÃ¡mara).  
- Feedback al usuario con notificaciones.  
- GestiÃ³n completa de ubicaciones.  
- **âœ… Sistema completo de carga y gestiÃ³n de base de datos Excel**.
- **âœ… BÃºsqueda inteligente de artÃ­culos con coincidencias dinÃ¡micas y base de datos**.
- **âœ… ExportaciÃ³n mejorada con nombres automÃ¡ticos de artÃ­culos**.
- **âœ… DetecciÃ³n y visualizaciÃ³n de cÃ³digos duplicados**.
- **âœ… UX mejorada con scroll automÃ¡tico y formateo**.
- **âœ… Sistema de recordar Ãºltima ubicaciÃ³n para workflow optimizado**.
- **âœ… Persistencia de ubicaciones entre sesiones de la app**.
- **âœ… Botones de limpieza con iconografÃ­a consistente y efectos visuales**.
- **âœ… Persistencia automÃ¡tica de base de datos Excel** - Se guarda y restaura automÃ¡ticamente sin intervenciÃ³n del usuario.
- **âœ… InicializaciÃ³n automÃ¡tica** - La base de datos se carga automÃ¡ticamente al iniciar la aplicaciÃ³n.
- **âœ… UX sin fricciones** - El usuario carga el archivo una vez y queda disponible para siempre.
- **ğŸš€ Sistema de navegaciÃ³n centralizado y moderno**:
  - Barra inferior flotante con configuraciÃ³n dinÃ¡mica por pÃ¡gina.
  - Arquitectura escalable para botones personalizados.
  - Limpieza de componentes obsoletos para mejor mantenimiento.
  - UX consistente en toda la aplicaciÃ³n.
- **ğŸ¯ Sistema de recompensas gamificado para pedidos**:
  - Iconos dinÃ¡micos segÃºn productividad diaria (ğŸ‘ğŸ”¥âš¡â­ğŸ’).
  - LÃ³gica diferenciada fin de semana vs dÃ­as laborables.
  - 5 niveles de logros que motivan el rendimiento.
  - Reconocimiento visual automÃ¡tico cada 10 pedidos.
- **ğŸ§¹ SimplificaciÃ³n de UI reciente**:
  - **Ubicaciones antiguas eliminadas** de TablaUbicaciones.vue - Solo visible en Excel.
  - **Buscador simplificado** sin indicadores de tipo de coincidencia.
  - **Interface mÃ¡s limpia** enfocada en informaciÃ³n esencial.
  - **Mejor experiencia de usuario** con menos distracciones visuales.
- **âœ… OptimizaciÃ³n de Excel de ubicaciones**:
  - **Anchos de columnas** ajustados segÃºn contenido real para mejor visualizaciÃ³n.
  - **Sistema de emojis** para identificaciÃ³n rÃ¡pida de problemas (âŒ/âœ”ï¸).
  - **Columna Info** que marca inmediatamente ubicaciones SL o artÃ­culos inexistentes.
  - **Formato 100% compatible** sin problemas de colores en diferentes versiones de Excel.

---

### ğŸ“‚ **Estructura de Archivos**
src/
â”œâ”€â”€ App.vue
â”œâ”€â”€ css/
â”‚   â””â”€â”€ app.css
â”œâ”€â”€ layouts/
â”‚   â””â”€â”€ MainLayout.vue
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ AjustarUbicaciones.vue
â”‚   â”œâ”€â”€ ErrorNotFound.vue
â”‚   â””â”€â”€ TablaPedidos.vue
â”œâ”€â”€ router/
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ routes.js
â””â”€â”€ components/
    â”œâ”€â”€ BaseDeDatos/
    â”‚   â”œâ”€â”€ CodigosArticulos.js
    â”‚   â”œâ”€â”€ almacenamiento.js
    â”‚   â”œâ”€â”€ usoAlmacenamientoCapacitor.js
    â”‚   â”œâ”€â”€ usoAlmacenamientoPedidos.js
    â”‚   â”œâ”€â”€ usoAlmacenamientoUbicaciones.js
    â”‚   â””â”€â”€ LectorExcel.js
    â”œâ”€â”€ Botones/
    â”‚   â”œâ”€â”€ BarraBotonesInferior.vue
    â”‚   â””â”€â”€ TresBotones.vue
    â”œâ”€â”€ Inicio/
    â”‚   â””â”€â”€ PanelInicio.vue
    â”œâ”€â”€ Logica/
    â”‚   â”œâ”€â”€ Envios/
    â”‚   â”‚   â””â”€â”€ CompartirExcel.js
    â”‚   â”œâ”€â”€ Pedidos/
    â”‚   â”‚   â”œâ”€â”€ CamaraPedidos.vue
    â”‚   â”‚   â”œâ”€â”€ CompartirExcel.js
    â”‚   â”‚   â”œâ”€â”€ ContadorPedidosDiarios.vue
    â”‚   â”‚   â”œâ”€â”€ ExportarPedidosExcel.js
    â”‚   â”‚   â”œâ”€â”€ GeneraExcel.js
    â”‚   â”‚   â”œâ”€â”€ HistorialPedidos.vue
    â”‚   â”‚   â””â”€â”€ PedidosRealizados.vue
    â”‚   â””â”€â”€ Ubicaciones/
    â”‚       â”œâ”€â”€ CamaraEscaneo.vue
    â”‚       â”œâ”€â”€ CamaraUbicaciones.vue
    â”‚       â”œâ”€â”€ CodigoMasNombre.vue
    â”‚       â”œâ”€â”€ ExportarUbicacionesExcel.js
    â”‚       â”œâ”€â”€ FormularioUbicacion.vue
    â”‚       â”œâ”€â”€ TablaUbicaciones.vue
    â”‚       â”œâ”€â”€ SelectorExcel.vue
    â”‚       â””â”€â”€ recordarUltimaTipografia.js
    â””â”€â”€ Modales/
        â”œâ”€â”€ ModalEditarPedido.vue
        â”œâ”€â”€ ModalEditarUbicacion.vue
        â”œâ”€â”€ ModalEliminar.vue
        â””â”€â”€ ModalNuevoPedido.vue

---

### ğŸ”§ **TecnologÃ­as y Dependencias**
- **Framework**: Vue 3 + Quasar
- **Capacitor**: Filesystem, Preferences
- **XLSX**: Procesamiento de archivos Excel
- **@zxing/library**: Escaneo de cÃ³digos
- **@tabler/icons-vue**: IconografÃ­a
- **Target**: Android en Play Store
