### **M√≥dulo de Configuraci√≥n - Bit√°cora II**

Sistema completo para gestionar la configuraci√≥n personalizada del usuario y nombres personalizados en archivos exportados.

---

### üì¶ **Componentes Principales**

#### **PaginaConfiguracion.vue**
- **P√°gina principal** de configuraci√≥n
- **Ruta**: `/configuracion`
- **Accesible desde**: Bot√≥n en footer del drawer en MainLayout
- **Contiene**: ConfiguracionUsuario.vue
- **Responsive design** adaptativo

#### **ConfiguracionUsuario.vue**
- **Formulario completo** para gestionar nombre de usuario
- **Input limpio** con placeholder din√°mico (no pre-rellena el campo)
- **Placeholder**: "Ingres√° tu nombre de usuario"
- **Validaciones**:
  - M√≠nimo 2 caracteres
  - Debe ser diferente al actual
  - Feedback visual de errores
- **Bot√≥n guardar**: Persiste el nuevo nombre
- **Bot√≥n resetear**: Abre modal de confirmaci√≥n para volver a "Usua des"
- **Modal de confirmaci√≥n**: Usa ModalEliminar.vue (componente reutilizable)
- **Feedback visual**: Notificaciones de √©xito/error con Quasar Notify
- **Persistencia autom√°tica**: Guarda inmediatamente en @capacitor/preferences

---

### üíæ **Almacenamiento y Persistencia**

#### **usoAlmacenamientoConfiguracion.js**
- **M√≥dulo dedicado** para persistir configuraci√≥n de usuario
- **Almacenamiento**: @capacitor/preferences
- **Key**: `"configuracionUsuario"`
- **Valor por defecto**: "Usua des"

**Funciones principales**:
guardarConfiguracion(config)       // Guarda objeto completo de configuraci√≥n
obtenerConfiguracion()             // Recupera configuraci√≥n guardada
limpiarConfiguracion()             // Resetea a valores por defecto
guardarNombreUsuario(nombre)       // Guarda solo el nombre de usuario
obtenerNombreUsuario()             // Recupera solo el nombre de usuario

**Estructura de configuraci√≥n**:
{
  nombreUsuario: "Usua des"        // Nombre del usuario (string)
}

**Caracter√≠sticas**:
- **Persistencia autom√°tica**: Los cambios se guardan inmediatamente
- **Recuperaci√≥n autom√°tica**: Se carga al iniciar la aplicaci√≥n
- **Valores por defecto**: Si no hay configuraci√≥n guardada, usa "Usua des"
- **Validaci√≥n**: Verifica que los datos sean v√°lidos antes de guardar

---

### üîÑ **Integraci√≥n con MainLayout**

#### **MainLayout.vue - Header**
- **Nombre din√°mico** en toolbar: `<q-toolbar-title>{{ nombreUsuario }}</q-toolbar-title>`
- **Carga autom√°tica** del nombre con polling cada 5 segundos
- **Actualizaci√≥n reactiva**: Cuando cambia en configuraci√≥n, se actualiza autom√°ticamente

#### **MainLayout.vue - Drawer (Avatar)**
- **Avatar din√°mico**: `@{{ nombreUsuario }}`
- **Posici√≥n**: En la parte superior del drawer
- **Estilo**: Avatar circular con fondo primario

#### **MainLayout.vue - Drawer (Bot√≥n Configuraci√≥n)**
- **Posici√≥n**: Footer del drawer
- **Icono**: IconSettings de @tabler/icons-vue
- **Animaci√≥n**: Rotaci√≥n al hacer hover
- **Acci√≥n**: Navega a `/configuracion`
- **Label**: "Configuraci√≥n"
- **Separaci√≥n adecuada** en dispositivos m√≥viles

**C√≥digo de carga del nombre**:
import { obtenerNombreUsuario } from '../components/BaseDeDatos/usoAlmacenamientoConfiguracion.js'

const nombreUsuario = ref('Usua des')

const cargarNombreUsuario = async () => {
  const nombre = await obtenerNombreUsuario()
  nombreUsuario.value = nombre || 'Usua des'
}

// Polling cada 5 segundos
setInterval(cargarNombreUsuario, 5000)

---

### üìÅ **Sistema de Nombres Personalizados en Archivos**

**Integraci√≥n completa del nombre de usuario en TODOS los archivos exportados.**

#### **Pedidos**
- **Con rango de fechas**: `Pedi [Usuario] DD-MM-AAAA - DD-MM-AAAA.xlsx`
  - Ejemplo: `Pedi Juan 01-01-2024 - 31-01-2024.xlsx`
- **Mensuales**: `Pedi [Usuario] - MM-AAAA.xlsx`
  - Ejemplo: `Pedi Juan - 01-2024.xlsx`
- **Nombre de hoja**: Solo el nombre del usuario
  - Ejemplo: Hoja llamada "Juan"

#### **Ubicaciones**
- **Formato**: `Ubic [Usuario].xlsx`
  - Ejemplo: `Ubic Juan.xlsx`
- **Nombre de hoja**: Solo el nombre del usuario
  - Ejemplo: Hoja llamada "Juan"

#### **Etiquetas**
- **Formato**: `etiquetas_[timestamp].docx`
  - Ejemplo: `etiquetas_1704067200000.docx`
- **Sin nombre de usuario** (es un documento Word, no Excel)

**Implementaci√≥n en exportadores**:
- ExportarPedidosExcel.js ‚Üí Importa `obtenerNombreUsuario()`
- ExportarUbicacionesExcel.js ‚Üí Importa `obtenerNombreUsuario()`
- Ambos llaman a la funci√≥n antes de generar el archivo
- Si no hay nombre configurado, usan "Usua des" por defecto

---

### üîÑ **Integraci√≥n con Barra de Botones**

#### **PaginaConfiguracion.vue**
configuracionBarra: {
  mostrarAtras: true,
  mostrarInicio: true,
  mostrarAgregar: false,
  mostrarEnviar: false,
  puedeEnviar: false,
  botonesPersonalizados: []
}

---

### ‚úÖ **Flujo de Trabajo T√≠pico**

1. **Acceder a configuraci√≥n**:
   - Abrir drawer (men√∫ lateral)
   - Click en bot√≥n "Configuraci√≥n" (con icono de engranaje)
   - Se abre PaginaConfiguracion.vue

2. **Cambiar nombre de usuario**:
   - Ver nombre actual en el formulario (placeholder)
   - Escribir nuevo nombre (m√≠nimo 2 caracteres)
   - Click en "Guardar"
   - **Validaci√≥n**: Si es igual al actual ‚Üí error
   - **√âxito**: Notificaci√≥n verde + actualizaci√≥n inmediata
   - **El nombre se actualiza** en header y drawer autom√°ticamente

3. **Resetear nombre**:
   - Click en bot√≥n "Resetear nombre"
   - Se abre modal de confirmaci√≥n
   - Confirmar ‚Üí Vuelve a "Usua des"
   - **Notificaci√≥n** de √©xito

4. **Ver cambios en archivos exportados**:
   - Al exportar pedidos ‚Üí archivo tiene tu nombre
   - Al exportar ubicaciones ‚Üí archivo tiene tu nombre
   - La hoja Excel tiene tu nombre como t√≠tulo

---

### üìä **Estructura de Datos**

#### **Configuraci√≥n Completa**
{
  nombreUsuario: "Juan"            // Nombre del usuario configurado
}

#### **Almacenamiento en Capacitor Preferences**
Key: "configuracionUsuario"
Value: { "nombreUsuario": "Juan" }

#### **Valor por Defecto**
Si no hay configuraci√≥n guardada:
{
  nombreUsuario: "Usua des"
}

---

### üé® **Caracter√≠sticas de UI/UX**

#### **Formulario de configuraci√≥n**
- **Dise√±o limpio**: Input con placeholder din√°mico
- **Sin pre-llenado**: El campo est√° vac√≠o hasta que escrib√≠s
- **Validaciones en tiempo real**: Muestra errores inmediatamente
- **Botones claros**: "Guardar" (verde) y "Resetear nombre" (rojo)
- **Modal de confirmaci√≥n**: Previene reseteos accidentales
- **Notificaciones**: Feedback visual inmediato

#### **Bot√≥n en drawer**
- **Icono de engranaje**: IconSettings rotando al hover
- **Posici√≥n fija**: Footer del drawer
- **Separaci√≥n responsive**: Se adapta a m√≥viles
- **Transici√≥n suave**: Animaci√≥n de rotaci√≥n 0.3s

#### **Header din√°mico**
- **Actualizaci√≥n autom√°tica**: Polling cada 5s
- **Sin recargar p√°gina**: Reactivo con Vue
- **Visible siempre**: En todas las p√°ginas de la app

---

### üîß **Dependencias Espec√≠ficas**

- **@capacitor/preferences**: Persistencia de datos
- **Quasar Notify**: Notificaciones de √©xito/error
- **@tabler/icons-vue**: Iconograf√≠a (IconSettings)
- **Vue Router**: Navegaci√≥n a `/configuracion`

---

### üöÄ **Posibles Expansiones Futuras**

**Ideas para agregar al m√≥dulo de configuraci√≥n:**

1. **Tema visual**:
   - Modo claro/oscuro
   - Colores personalizados
   - Tama√±o de fuente

2. **Preferencias de exportaci√≥n**:
   - Formato de fecha preferido
   - Idioma de archivos
   - Carpeta de destino por defecto

3. **Notificaciones**:
   - Activar/desactivar sonidos
   - Duraci√≥n de notificaciones
   - Tipo de alertas

4. **Permisos**:
   - Gesti√≥n de c√°mara
   - Gesti√≥n de archivos
   - Gesti√≥n de ubicaci√≥n

5. **Datos de empresa**:
   - Logo personalizado
   - Informaci√≥n de contacto
   - Datos fiscales

6. **Respaldos**:
   - Exportar toda la configuraci√≥n
   - Importar configuraci√≥n
   - Sincronizaci√≥n en la nube

7. **Seguridad**:
   - PIN de acceso
   - Huella digital
   - Timeout de sesi√≥n

---

### üìù **Notas Importantes**

- La configuraci√≥n se **carga autom√°ticamente** al iniciar la app
- El **polling cada 5 segundos** asegura que el nombre est√© siempre actualizado
- El **modal de confirmaci√≥n** previene reseteos accidentales
- El **valor por defecto** "Usua des" garantiza que siempre haya un nombre
- Los **archivos exportados** usan el nombre configurado autom√°ticamente
- La **validaci√≥n de m√≠nimo 2 caracteres** evita nombres muy cortos
- El **placeholder din√°mico** mejora la UX al no pre-llenar el campo
- El **bot√≥n en el drawer** es accesible desde cualquier p√°gina
- La **estructura JSON** facilita agregar m√°s configuraciones en el futuro
